---
title: "Berlin CO2 Leistungsbild"
author: "Bhaskar Kamble und Johannes Hengstenberg"
date: "29 Oktober 2019"
output:
  pdf_document:
    toc: yes
    toc_depth: '3'
  html_document:
    code_folding: hide
    theme: united
    toc: yes
    toc_depth: 3
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '3'
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE,cache=FALSE)
```

# <font size="20">Teil 1.</font>

```{r}
showResults <- "hide" # the options are "show" or "hide"
```



```{r}
#General Notes:

#Have all co2 emissions for the Bezirke ready, then add then up to find the co2 for berlin

#You can compare the sum of all bezirke with the total for Berlin also

#Use this:

#file:///D:/GITHUB_REPOS/co2emissions/Berlin/BezirkAnalysis/01_charlottenburg_wilmersdorf/ExtractData2.R


#Important variables:

#* berlin_co2_all: kilo tons of co2 emitted by each bezirk in each year. (all = mfh+sfh)
#* bezirk_areas_all: areas of each bezirk in each year.
#* bezirk_spez_co2: per unit area co2 emitted by each bezirk in each year.
#* bezirke_spez_co2_linea: linear trend of bezirke_spez_co2
#* spez_co2_emission: berlin all buildings, specific co2 emissions for each year
#* bezirk_population: population of each bezirk in each year for mfh+sfh. "
```

```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getAllBezirkeTotalCO2_v2.R")
alle_bezirke_co2 <- getAllBezirkeTotalCO2()
```


```{r}
yco2 <- "Mio. t"
yco2perhead <- "kg/Kopf"
yspezco2 <- expression(kg/m^2)
```










# Berlin, Stichprobengröße

## MFH + 1-2 FH

```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/FiguresForSenate/saveFigure.R")
```

```{r}
gtypeForFig <- "ALL"
Teil <- 1
figIndex <- 1
```

### Gesamt
```{r}
get_BezirkNames <- function(obj) {
  obj[obj=="charlottenburg_wilmersdorf"] <- "Charlottenburg-Wilmersdorf"
  obj[obj=="friedrichshain_kreuzberg"]   <- "Friedrichshain-Kreuzberg"
  obj[obj=="lichtenberg"]                <- "Lichtenberg"
  obj[obj=="marzahn_hellersdorf"]        <- "Marzahn-Hellersdorf"
  obj[obj=="mitte"]                      <- "Mitte"
  obj[obj=="neukoelln"]                  <- "Neukölln"
  obj[obj=="pankow"]                     <- "Pankow"
  obj[obj=="reinickendorf"]              <- "Reinickendorf"
  obj[obj=="spandau"]                    <- "Spandau"
  obj[obj=="steglitz_zehlendorf"]        <- "Steglitz-Zehlendorf"
  obj[obj=="tempelhof_schoeneberg"]      <- "Tempelhof-Schöneberg"
  obj[obj=="treptow_koepenick"]          <- "Treptow-Köpenick"
  return(obj)
}
```


```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getSampleSize.R")
berlin_sample_size <- getSampleSize()
```


```{r}
require(ggplot2)
ggplot(berlin_sample_size$ALL) + geom_point(aes(x=abrechnungsjahr,y=total))+labs(x="Jahr",y="Stichprobengröße",title="Berlin, alle Wohngebäude (Stichprobengröße)")+scale_x_continuous(breaks=seq(2002,2018,2))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex)
```


```{r,results = showResults}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/createTable.R")
berlin_sample_size$ALL[,c("abrechnungsjahr","total")]
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = berlin_sample_size$ALL[,c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude,\nStichprobengröße",
            columnNames = c("Jahr","N"),
            columnWidths = c(1,1),
            addColTotals = TRUE)
```


### Nach Bezirken

```{r}
#names(berlin_sample_size$ALL) <- get_BezirkNames(names(berlin_sample_size$ALL))
```


```{r}
plot_reqdColumns <- function(input_data,   # data frame
                             xVar,         # column name of "input_data" to be plotted on the x-axis
                             cols_to_plot, #column names of "input_data" to be plotted on the y-axis
                             yColsName,    # for eg. if cols_to_plot = c("Bonn","Berlin"), then this can be City
                             yVar,        # for eg. "population" if the columns for "Berlin" etc. show population
                             plot_title = NULL,
                             xlabel = NULL,
                             ylabel = NULL,
                             regLine = TRUE,
                             kt_to_mt = FALSE
) {
  
  if (kt_to_mt) {
    source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/convert_kilo_to_megaton.R")
    input_data <- convert_kilo_to_megaton(input_data , "abrechnungsjahr")
  }
  
  input_data <- input_data[ , c(xVar , cols_to_plot)]
  names(input_data) <- get_BezirkNames(names(input_data))
  
  #convert data to long format
  require(reshape2)
  input_data <- melt(input_data , id.vars = xVar )
  names(input_data) <- c(xVar , yColsName , yVar)
    
  require(ggplot2)
  return_object <- 
    ggplot(input_data
    )+geom_point(aes(x=get(xVar),y=get(yVar),col=get(yColsName))
    ) + geom_smooth(method="lm",aes(x=get(xVar),y=get(yVar),col=get(yColsName)),se=FALSE
    )+scale_color_discrete(name = yColsName
    )+labs(x=xlabel,y=ylabel,title=plot_title)+ylim(0,max(input_data[[yVar]]))
  
  if (regLine==FALSE) {
      return_object <- 
    ggplot(input_data
    )+geom_line(aes(x=get(xVar),y=get(yVar),col=get(yColsName)) 
    )+geom_point(aes(x=get(xVar),y=get(yVar),col=get(yColsName))
    )+scale_color_discrete(name = yColsName
    )+labs(x=xlabel,y=ylabel,title=plot_title)+ylim(0,max(input_data[[yVar]]))
  }
  
  detach("package:reshape2")
  #detach("package:ggplot2")
 
  return(return_object) 
}
```

```{r}
#plot(berlin_co2_all$abrechnungsjahr , berlin_co2_all$total)
require(ggplot2)
#look at line 187 of BerlinPresentationCO2BalanceUnified_v6.Rmd
points_line_lm <- function(input_data,
                           xVar,
                           yVar,
                           ymin,
                           ymax,
                           x_eq=2008,
                           y_eq=2500,
                           size_eq=6,
                           plot_title,
                           xlab,
                           ylab,
                           slope_round_to = 2,
                           intercept_round_to = 0,
                           regLine = TRUE,
                           kt_to_mt = FALSE) {
  if (kt_to_mt) {
    source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/convert_kilo_to_megaton.R")
    input_data <- convert_kilo_to_megaton(input_data , "abrechnungsjahr")
    y_eq <- 0.001*y_eq
    ymin <- 0.001*ymin
    ymax <- 0.001*ymax
  }
  linmod <- lm(data=input_data , formula = get(yVar)~get(xVar))
  coeff_a <- as.numeric(coefficients(linmod)[1])
  coeff_b <- as.numeric(coefficients(linmod)[2])
  if (coeff_a<0) {
    sign_coeff_a <- " "
  } else {sign_coeff_a <- "+"}
  
  
  b_round <- as.character(round(coeff_b,slope_round_to))
  a_round <- as.character(round(coeff_a,intercept_round_to))
  lm_equation <- paste0( b_round , "x" , sign_coeff_a ,  a_round)
  
  g <- ggplot() + geom_line(data=input_data , aes(x=get(xVar) , y=get(yVar)) , color="blue"
  )+geom_point(data=input_data , aes(x=get(xVar) , y=get(yVar)) , color="blue"
  )+geom_smooth(method="lm" , data=input_data , aes(x=get(xVar) , y=get(yVar)) , se=FALSE
  )+annotate(geom="text" , label=lm_equation , x = x_eq , y = y_eq , size=size_eq
  )+ylim(ymin,ymax)+scale_x_continuous(breaks=seq(2002,2018,2)
  )+theme_bw()+labs(x=xlab,
  y=ylab,title=plot_title)+theme(
    plot.title=element_text(size=10), 
    axis.title.x=element_text(size=15, face="bold"), 
    axis.title.y = element_text(size=15, face="bold"), 
    axis.text.x=element_text(size=10,face="bold"), 
    axis.text.y=element_text(size=10,face="bold")
  )
  if (regLine == FALSE) {
     g <- ggplot() + geom_line(data=input_data , aes(x=get(xVar) , y=get(yVar)) , color="blue"
  )+geom_point(data=input_data , aes(x=get(xVar) , y=get(yVar)) , color="blue"
  )+ylim(ymin,ymax)+scale_x_continuous(breaks=seq(2002,2018,2)
  )+theme_bw()+labs(x=xlab,
  y=ylab,title=plot_title)+theme(
    plot.title=element_text(size=10), 
    axis.title.x=element_text(size=15, face="bold"), 
    axis.title.y = element_text(size=15, face="bold"), 
    axis.text.x=element_text(size=10,face="bold"), 
    axis.text.y=element_text(size=10,face="bold")
  ) 
  }
  return(g)
}
```

```{r}
bezirk_list <- c("charlottenburg_wilmersdorf",
                 "friedrichshain_kreuzberg",
                 "lichtenberg",
                 "marzahn_hellersdorf",
                 "mitte",
                 "neukoelln",
                 "pankow",
                 "reinickendorf",
                 "spandau",
                 "steglitz_zehlendorf",
                 "tempelhof_schoeneberg",
                 "treptow_koepenick")
bezirk_name <- c("Charlottenburg-Wilmersdorf","Friedrichshain-Kreuzberg","Lichtenberg","Marzahn-Hellersdorf","Mitte","Neukölln",                  
  "Pankow","Reinickendorf","Spandau","Steglitz-Zehlendorf","Tempelhof-Schöneberg","Treptow-Köpenick")
plot_bezirkeGridPlot <- function(obj,ylabel,regLine=TRUE,slope_round_to=2,kt_to_mt=FALSE) {
  max_y_val <- max(obj[ , names(obj)[!(names(obj) %in% c("abrechnungsjahr","total"))]])
  g_return <- list()
  require(ggplot2)
  for (ii in 1:12) {
    g_return[[ii]] <- points_line_lm(input_data = obj,
                                     xVar = "abrechnungsjahr",
                                     yVar = bezirk_list[ii],
                                     ymin=0,
                                     ymax=max_y_val,
                                     x_eq = 2010,
                                     y_eq = 0.5*max_y_val,
                                     size_eq = 4,
                                     plot_title = bezirk_name[ii],
                                     xlab = "Jahr",
                                     ylab = ylabel,
                                     slope_round_to = slope_round_to,
                                     regLine = regLine,
                                     kt_to_mt = kt_to_mt)
  }
  return(g_return)
}
```


```{r}
plot_reqdColumns(berlin_sample_size$ALL,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_sample_size$ALL)[!(names(berlin_sample_size$ALL)) %in% c("abrechnungsjahr","total")],
                 yColsName = "Bezirk",
                 yVar = "N",
                 plot_title = "Stichprobengröße, alle Wohngebäude",
                 xlabel = "Jahr",
                 ylabel = "N",
                 regLine = FALSE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex)
```


```{r,fig.width=10,fig.height=10}
gg_N <- plot_bezirkeGridPlot(berlin_sample_size$ALL,ylabel="N",regLine=FALSE)
require(grid)
require(gridExtra)
grid.arrange(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3
)
whatToSave <- arrangeGrob(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex , whatToSave = whatToSave)
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_sample_size$ALL[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


```{r,fig.width=10,fig.height=6}
createTable(berlin_sample_size$ALL[, c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


### Nach Energieträgern


```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getSampleSizeByET.R")
berlin_sample_size_by_et <- getSampleSizeByET()
berlin_sample_size_by_et$ALL <- berlin_sample_size_by_et$ALL[ , c("abrechnungsjahr", "erdgas", "waerme", "fluessiggas", "heizoel" ,"holzpellets", "strom", "total")]
berlin_sample_size_by_et$SFH <- berlin_sample_size_by_et$SFH[ , c("abrechnungsjahr", "erdgas", "waerme", "fluessiggas", "heizoel" ,"holzpellets", "strom", "total")]
berlin_sample_size_by_et$MFH <- berlin_sample_size_by_et$MFH[ , c("abrechnungsjahr", "erdgas", "waerme", "fluessiggas", "heizoel" ,"holzpellets", "strom", "total")]
```

```{r,fig.width=10,fig.height=7}

createTable(berlin_sample_size_by_et$ALL,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Stichprobengröße nach Energieträgern",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


## 1-2 FH


```{r}
gtypeForFig <- "SFH"
figIndex <- 1
```

### Gesamt

```{r}
require(ggplot2)
ggplot(berlin_sample_size$SFH) + geom_point(aes(x=abrechnungsjahr,y=total))+labs(x="Jahr",y="Stichprobengröße",title="Berlin, 1-2 Familiengebäude")+scale_x_continuous(breaks=seq(2002,2018,2))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex )
```


```{r,fig.width=2.5,fig.height=7}
createTable(obj = berlin_sample_size$SFH[,c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude,\nStichprobengröße",
            columnNames = c("Jahr","N"),
            columnWidths = c(1,1),
            addColTotals = TRUE)
```

### Nach Bezirken


```{r}
plot_reqdColumns(berlin_sample_size$SFH,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_sample_size$SFH)[!(names(berlin_sample_size$SFH)) %in% c("abrechnungsjahr","total")],
                 yColsName = "Bezirk",
                 yVar = "N",
                 plot_title = "Stichprobengröße, 1-2 Familiengebäude",
                 xlabel = "Jahr",
                 ylabel = "N",
                 regLine = FALSE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex)
```


```{r,fig.width=10,fig.height=10}
gg_N <- plot_bezirkeGridPlot(berlin_sample_size$SFH,ylabel="N",regLine=FALSE)
require(grid)
require(gridExtra)
grid.arrange(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3
)
whatToSave <- arrangeGrob(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3
)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex , whatToSave = whatToSave)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_sample_size$SFH[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


```{r,fig.width=10,fig.height=6}
createTable(berlin_sample_size$SFH[, c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```

### Nach Energieträgern


```{r,fig.width=10,fig.height=7}

createTable(berlin_sample_size_by_et$SFH,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Stichprobengröße nach Energieträgern",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```






## MFH

```{r}
Teil <- 1
gtypeForFig <- "MFH"
figIndex <- 1
```

### Gesamt

```{r}
require(ggplot2)
ggplot(berlin_sample_size$MFH) + geom_point(aes(x=abrechnungsjahr,y=total))+labs(x="Jahr",y="Stichprobengröße",title="Berlin, Mehrfamiliengebäude")+scale_x_continuous(breaks=seq(2002,2018,2))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex)
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = berlin_sample_size$MFH[,c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude,\nStichprobengröße",
            columnNames = c("Jahr","N"),
            columnWidths = c(1,1),
            addColTotals = TRUE)
```

### Nach Bezirken


```{r}
plot_reqdColumns(berlin_sample_size$MFH,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_sample_size$MFH)[!(names(berlin_sample_size$MFH)) %in% c("abrechnungsjahr","total")],
                 yColsName = "Bezirk",
                 yVar = "N",
                 plot_title = "Stichprobengröße, Mehrfamiliengebäude",
                 xlabel = "Jahr",
                 ylabel = "N",
                 regLine = FALSE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex)
```


```{r,fig.width=10,fig.height=10}
gg_N <- plot_bezirkeGridPlot(berlin_sample_size$MFH,ylabel="N",regLine=FALSE)
require(grid)
require(gridExtra)
grid.arrange(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3
)
whatToSave <- arrangeGrob(gg_N[[1]],gg_N[[2]],gg_N[[3]],gg_N[[4]],
             gg_N[[5]],gg_N[[6]],gg_N[[7]],gg_N[[8]],
             gg_N[[9]],gg_N[[10]],gg_N[[11]],gg_N[[12]],ncol=3
)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , Teil=Teil , figIndex=figIndex , whatToSave = whatToSave)
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_sample_size$MFH[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


```{r,fig.width=10,fig.height=6}
createTable(berlin_sample_size$MFH[, c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Stichprobengröße nach Bezirken",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```

### Nach Energieträgern


```{r,fig.width=10,fig.height=7}

createTable(berlin_sample_size_by_et$MFH,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Stichprobengröße nach Energieträgern",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            #columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


```{r}
i_section <- 1
```

# `r i_section`. Berlin, MFH + 1-2 FH, CO2-Emission aus Beheizung

```{r}
gtypeForFig <- "ALL"
```

```{r}
i_subsection <- 1
```



## `r i_section`.`r i_subsection` Absolute Zahlen


```{r}
i_subsubsection <- 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018 in 1.000 t

```{r}
figIndex <- 1
```

```{r}
# * Berlin, summed over all Bezirke and all Energieträger.
# * Berlin, summed over all Bezirke, split by Energietr?ger.
```
 
```{r}
#alle_bezirke_co2$all - datatframe of year, and co2 emissions of each bezirk , summed over ET.
berlin_co2_all <- getRowSums(alle_bezirke_co2$all , dropCols = "abrechnungsjahr")
#berlin_co2_all
```




```{r}
changeCO2_to_CO_2 <- function(obj) {
  objBefore <- strsplit(obj,"CO2")[[1]][1]
  objAfter <- strsplit(obj,"CO2")[[1]][2]
  return(bquote(.(objBefore)*CO[2] * .(objAfter)))
}
```



```{r}
points_line_lm(input_data = berlin_co2_all,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(berlin_co2_all$total),
               x_eq = 2010,
               y_eq = 3600,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("CO2 Emissionen in Berlin, alle Wohngebäude"),
               xlab = "Jahr",
               ylab = yco2,
               kt_to_mt = TRUE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
berlin_co2_all[, c("abrechnungsjahr","total")]
```


```{r,fig.width=2.5,fig.height=7}
createTable(obj = berlin_co2_all[, c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, \nCO2 Emissionen",
            columnNames = c("Jahr","kilo t."),
            columnWidths = c(1,1),
            columnsToRound = "kilo t."
)
```

```{r}
#* Now you should write a new function which gives the CO2 emission of Berlin, MFH+SFH, summed over all Bezirke, and split by ET.
```


```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getAllBezirkeByETCO2_v2.R")
co2_allebezirke_byET <- getAllBezirkeByETCO2()
co2_all_allebezirke_byET <- co2_allebezirke_byET$all
#co2_all_allebezirke_byET
```


```{r}
require(ggplot2)
col_list <- c("royalblue4","orangered1","gray59","orange","blue","olivedrab4")
cols <- c(
          "erdgas"      = "royalblue4",
          "waerme"      = "orangered1",
          "fluessiggas" = "gray59",
          "heizoel"     = "orange",
          "holzpellets" = "blue",
          "strom"       = "olivedrab4"
          )
plot_title <- NULL
order_legend <- rev(c("erdgas","waerme","fluessiggas","heizoel","holzpellets","strom"))
order_labels <- rev(c("Erdgas","Wärme (N+F)","Flüssiggas","Heizöl","Holzpellets","Strom (D+WP)"))
et_list <- c("erdgas","waerme","fluessiggas","heizoel","holzpellets","strom")
plot_byET <- function(obj,xlabel,ylabel,plottitle,kt_to_mt=FALSE) {
  if (kt_to_mt) {
    source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/convert_kilo_to_megaton.R")
    obj <- convert_kilo_to_megaton(obj , "abrechnungsjahr")
  }
  ggplot()+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[1]),color=et_list[1]),size=5
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[2]),color=et_list[2])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[3]),color=et_list[3])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[4]),color=et_list[4])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[5]),color=et_list[5])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(et_list[6]),color=et_list[6])
  )+scale_color_manual(labels=order_labels,name=" ",values=cols,breaks=order_legend
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[6])),fill=col_list[6]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[5])),fill=col_list[5]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[4])),fill=col_list[4]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[3])),fill=col_list[3]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[2])),fill=col_list[2]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(et_list[1])),fill=col_list[1])+theme_bw()+ labs(x=xlabel,y=ylabel,title=plottitle) + theme(
    plot.title=element_text(size=10), 
    axis.title.x=element_text(size=15, face="bold"), 
    axis.title.y = element_text(size=15, face="bold"), 
    legend.text = element_text(size=12), 
    axis.text.x=element_text(size=10,face="bold"), 
    axis.text.y=element_text(size=10,face="bold"), 
    legend.key.size=unit(2, "lines")
  )+scale_x_continuous(breaks=seq(2002,2018,2))
}
```

```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getCumSums.R")
co2_all_allebezirke_byET_cumsums <- getCumSums(obj=co2_all_allebezirke_byET , dropCols=c("abrechnungsjahr","total"))
#co2_all_allebezirke_byET_cumsums
plot_byET(co2_all_allebezirke_byET_cumsums , 
          xlabel = "Jahr" , 
          ylabel = yco2 , 
          plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, alle Wohngebäude, nach Energieträgern"),
          kt_to_mt = TRUE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
co2_all_allebezirke_byET
```

```{r,fig.width=10,fig.height=7}
createTable(co2_all_allebezirke_byET,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen in kilo t. nach Energieträgern",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```





### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018 summiert in 1.000 t



```{r}
#* Here split by the Bezirke
```





```{r}
bezirk_list <- names(berlin_co2_all)[!(names(berlin_co2_all)%in% c("abrechnungsjahr","total"))]
#bezirk_list

#data.frame(blist = bezirk_list , bname = get_BezirkNames(bezirk_list))
bezirk_name <- get_BezirkNames(bezirk_list)
```

```{r}
berlin_co2_all_cumsums <- getCumSums(obj=berlin_co2_all , dropCols=c("abrechnungsjahr","total"))
```






```{r}
gg_color_hue <- function(n) {
  hues = seq(15, 375, length = n + 1)
  hcl(h = hues, l = 65, c = 100)[1:n]
}
cols_bezirk <- gg_color_hue(12)
names(cols_bezirk) <- bezirk_name
order_legend_bez <- bezirk_name
order_labels_bez <- bezirk_name
```



```{r}
plot_byBezirke <- function(obj,xlabel,ylabel,plottitle,kt_to_mt=FALSE) {
  if (kt_to_mt) {
    source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/convert_kilo_to_megaton.R")
    obj <- convert_kilo_to_megaton(obj , "abrechnungsjahr")
  }
  names(obj) <- get_BezirkNames(names(obj))
  ggplot()+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[1]),color=bezirk_name[1]),size=5
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[2]),color=bezirk_name[2])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[3]),color=bezirk_name[3])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[4]),color=bezirk_name[4])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[5]),color=bezirk_name[5])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[6]),color=bezirk_name[6])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[7]),color=bezirk_name[7])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[8]),color=bezirk_name[8])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[9]),color=bezirk_name[9])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[10]),color=bezirk_name[10])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[11]),color=bezirk_name[11])
  )+geom_line(data=obj,aes(x=abrechnungsjahr,y=get(bezirk_name[12]),color=bezirk_name[12])
  )+scale_color_manual(labels=order_labels_bez,name=" ",values=cols_bezirk,breaks=order_legend_bez
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[12])),fill=cols_bezirk[12]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[11])),fill=cols_bezirk[11]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[10])),fill=cols_bezirk[10]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[9])),fill=cols_bezirk[9]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[8])),fill=cols_bezirk[8]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[7])),fill=cols_bezirk[7]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[6])),fill=cols_bezirk[6]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[5])),fill=cols_bezirk[5]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[4])),fill=cols_bezirk[4]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[3])),fill=cols_bezirk[3]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[2])),fill=cols_bezirk[2]
  )+geom_ribbon(data=obj,aes(x=abrechnungsjahr,ymin=0,ymax=get(bezirk_name[1])),fill=cols_bezirk[1]
  )+theme_bw()+ labs(x=xlabel,y=ylabel,title=plottitle) + theme(plot.title=element_text(size=10), axis.title.x=element_text(size=10, face="bold"), axis.title.y=element_text(size=10, face="bold"), legend.text = element_text(size=8), axis.text.x=element_text(size=15,face="bold"), axis.text.y=element_text(size=12,face="bold"), legend.key.size=unit(2, "lines"),legend.position = "bottom"
  )+scale_x_continuous(breaks=seq(2002,2018,2))
}
```


```{r}
plot_byBezirke(berlin_co2_all_cumsums , xlabel = "Jahr" , ylabel = yco2 , plottitle=changeCO2_to_CO_2("CO2 Emissionen in Berlin, alle Wohngebäude, nach Bezirk"),kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_all
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018 in Prozent

```{r}
#* Here the percent of the co2 emission broken up by percentage - by ET first, and then by bezirk. 

#* The function `find_proportions` is to be used for this purpose.
```

```{r}
#find_proportions
```


```{r}
#co2_all_allebezirke_byET
```

```{r}
co2_all_allebezirke_byET_prop <- find_proportions(co2_all_allebezirke_byET , drop_cols = c("abrechnungsjahr","total"))
#co2_all_allebezirke_byET_prop
```

```{r}
co2_all_allebezirke_byET_prop_cumsums <- getCumSums(obj=co2_all_allebezirke_byET_prop , dropCols = "abrechnungsjahr")
#co2_all_allebezirke_byET_prop_cumsums
```

```{r}
plot_byET(co2_all_allebezirke_byET_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, alle Wohngebäude, Anteile nach Energieträgern"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
co2_all_allebezirke_byET_prop
```

```{r,fig.width=8.75,fig.height=7}
createTable(co2_all_allebezirke_byET_prop,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen, Anteile nach Energieträgern (%)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom")
)
```

```{r}
berlin_co2_all_prop <- find_proportions(berlin_co2_all,drop_cols=c("abrechnungsjahr","total"))
berlin_co2_all_prop_cumsums <- getCumSums(berlin_co2_all_prop,dropCols="abrechnungsjahr")
plot_byBezirke(berlin_co2_all_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, alle Wohngebäude, Anteile nach Bezirk"))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_all_prop
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all_prop[ , c(1:6,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all_prop[ , c(7:12,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```



### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018 in 1.000 t





```{r}
#(Eine Grafik: co2 Emissionen je Bezirk und Jahr)
#Co2 emissions of all city districts by year in a single graph. (year on x-axis and co2 emission on y-axis).
#One Graph: Co2 emissions of all city districts by year
```

```{r}
plot_reqdColumns(berlin_co2_all,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_co2_all)[!(names(berlin_co2_all) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "kilo t.",
                 plot_title = changeCO2_to_CO_2("CO2 Emissionen von Stadtbezirken, alle Wohngebäude"),
                 xlabel = "Jahr",
                 ylabel = yco2,
                 kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```



```{r,fig.width=10,fig.height=10}
max_co2_value <- max(berlin_co2_all[ , names(berlin_co2_all)[!(names(berlin_co2_all) %in% c("abrechnungsjahr","total"))]])
require(ggplot2)
g_co2_bezirk <- list()
for (ii in 1:12) {
  g_co2_bezirk[[ii]] <- points_line_lm(input_data = berlin_co2_all,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=max_co2_value,
                                       x_eq = 2010,
                                       y_eq = 0.5*max_co2_value,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = yco2,
                                       slope_round_to = 4,
                                       kt_to_mt = TRUE)
}
#require(grid)
require(gridExtra)
grid.arrange(g_co2_bezirk[[1]],g_co2_bezirk[[2]],g_co2_bezirk[[3]],g_co2_bezirk[[4]],
             g_co2_bezirk[[5]],g_co2_bezirk[[6]],g_co2_bezirk[[7]],g_co2_bezirk[[8]],
             g_co2_bezirk[[9]],g_co2_bezirk[[10]],g_co2_bezirk[[11]],g_co2_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2_bezirk[[1]],g_co2_bezirk[[2]],g_co2_bezirk[[3]],g_co2_bezirk[[4]],
             g_co2_bezirk[[5]],g_co2_bezirk[[6]],g_co2_bezirk[[7]],g_co2_bezirk[[8]],
             g_co2_bezirk[[9]],g_co2_bezirk[[10]],g_co2_bezirk[[11]],g_co2_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
berlin_co2_all
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018, Veränderung in Prozent

**(CO2 emitted by a bezirk for a particualar year - Average CO2 emitted by a bezirk in particular year)/(Average CO2 emitted by a bezirk in particular year) times 100**

```{r}
getDeviationsFromMean <- function(input_data,xVar,colsToAvgOver) {
  input_data <- input_data[ , c(xVar , colsToAvgOver)]
  input_data$meanVal <-  rowMeans(input_data[ , colsToAvgOver])
  for (colName in colsToAvgOver) {
    input_data[[colName]] <- 100.0*(input_data[[colName]] - input_data[["meanVal"]])/input_data[["meanVal"]]
  }
  return(input_data)
}
```

```{r}
berlin_co2_all_devFromMean <- getDeviationsFromMean(berlin_co2_all,
                                                    xVar = "abrechnungsjahr",
                                                    colsToAvgOver = names(berlin_co2_all)[
                                                      !(names(berlin_co2_all
                                                              ) %in% c("abrechnungsjahr","total"))]
)
```

```{r}
#berlin_co2_all_devFromMean
```



```{r}
plotDevFromMean <- function(input_data,xVar,yVar,ymin,ymax,ylabel,plot_title) {
  input_data <- input_data[, c(xVar,yVar)]
  input_data$p_or_m <- as.integer(input_data[[yVar]] > 0)
  input_data$p_or_m[input_data$p_or_m == 0] <- "g_reen"
  input_data$p_or_m[input_data$p_or_m == 1] <- "r_ed"
  return(
    ggplot(data=input_data,aes(x=get(xVar),y=get(yVar),fill=p_or_m))+geom_bar(stat="identity")+scale_fill_manual(values=c("g_reen" = "green", "r_ed" = "red") )+ylim(ymin,ymax)+theme(legend.position="none")+labs(title=plot_title,x="Jahr",y=ylabel)
  )
  #
}
```

```{r}
ymin <- min(berlin_co2_all_devFromMean[ , 
                                        names(berlin_co2_all_devFromMean)[
                                          !(names(berlin_co2_all_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
ymax <- max(berlin_co2_all_devFromMean[ , 
                                        names(berlin_co2_all_devFromMean)[
                                          !(names(berlin_co2_all_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
#plotDevFromMean(berlin_co2_all_devFromMean,"abrechnungsjahr","mitte",yMin=yMin,yMax=yMax)
g_co2dev_bezirk <- list()
for (ii in 1:12) {
  g_co2dev_bezirk[[ii]] <- plotDevFromMean(input_data = berlin_co2_all_devFromMean,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=ymin,
                                       ymax=ymax,
                                       ylabel="Abweichung vom Mittelwert (%)",
                                       plot_title = bezirk_name[ii])
}
```

```{r,fig.width=10,fig.height=10}
require(grid)
require(gridExtra)
grid.arrange(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
berlin_co2_all_devFromMean
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all_devFromMean[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, CO2 Emissionen, Abweichung vom Mittelwert (%)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_all_devFromMean[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, CO2 Emissionen, Abweichung vom Mittelwert (%)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```





```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emission aus der Beheizung von Wohnraum 2002-2018, in Prozent

* Pending


```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection` Flächenbezug

```{r}
i_subsubsection <- 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, MFH + 1-2 FH, flächenbezogene co2 Emission aus der Beheizung von Wohnraum 2002-2018 in kg/m2 [AN]

Here you have to get the areas of SFH and MFH buildings...


* Short method: Do as in BerlinPresentationCO2BalanceUnified_v7.Rmd. I.e. read directly from the file for total Berlin areas.

```{r}
totalArea <- read.table("/home/kbhaskar/Github_Repos/co2emissions/Berlin/berlin_wohnflaeche.txt",header=TRUE)
totalArea <- totalArea*1000000
totalArea$totArea <- rowSums(totalArea)
totalArea$abrechnungsjahr <- 2002:2018
#totalArea <- totalArea[ , c("abrechnungsjahr","totArea")]
#totalArea
```



* Long method: find for each bezirk separately, and add them. The units of Bezirk areas are 100 m-squared in the original file. So multiply with 100 to get the areas in m^2.

```{r}
bezirk_areas_sfh <- 100*getRowSums(obj=alle_bezirke_co2$areas_sfh , dropCols = "abrechnungsjahr")
bezirk_areas_mfh <- 100*getRowSums(obj=alle_bezirke_co2$areas_mfh , dropCols = "abrechnungsjahr")
bezirk_areas_all <- bezirk_areas_mfh + bezirk_areas_sfh
bezirk_areas_all$abrechnungsjahr <- 2002:2018
#bezirk_areas_all
```


*WHY DO I GET A FACTOR OF 1.4 OFF IN THE TWO METHODS ????*

Use the long method.

```{r}
#spz_co2 <- 1e6*berlin_co2_all$total/totalArea$totArea
spz_co2 <- 1e6*berlin_co2_all$total/bezirk_areas_all$total
spez_co2_emission <- data.frame(abrechnungsjahr=2002:2018 , spez_co2 = spz_co2 )
```


```{r}
#spez_co2_emission
```

```{r}
points_line_lm(input_data = spez_co2_emission,
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=max(spez_co2_emission$spez_co2),
               x_eq = 2010,
               y_eq = 20,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, alle Wohngebäude"),
               xlab = "Jahr",
               ylab = yspezco2)
figIndex <- 1

figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
spez_co2_emission
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = spez_co2_emission[, c("abrechnungsjahr","spez_co2")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, \nSpezifische CO2 Emissionen",
            columnNames = c("Jahr","kg / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kg / q.m."
)
```



```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, flächenbezogene co2 Emission aus der Beheizung von Wohnraum 2002-2018 in kg/m2 [AN]

*Is this not similar to 7.2.1?*

*Or am I supposed to show the pictures of all the bezirke simultaneously?*




```{r}
#berlin_co2_all
```

```{r}
#bezirk_areas_all
```


```{r}
bezirke_spez_co2 <- 1e6*berlin_co2_all/bezirk_areas_all
bezirke_spez_co2$abrechnungsjahr <- 2002:2018
```

```{r}
#bezirke_spez_co2
```







```{r}
plot_reqdColumns(bezirke_spez_co2,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirke_spez_co2)[!(names(bezirke_spez_co2) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "kg/qm",
                 plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen von Stadtbezirken, alle Wohngebäude"),
                 xlabel = "Jahr",
                 ylabel = yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```




```{r,fig.height=10,fig.width=10}
reqdCols <- names(bezirke_spez_co2)[!(names(bezirke_spez_co2) %in% c("abrechnungsjahr" , "total"))]
ymax <- max(bezirke_spez_co2 [ , reqdCols])
g_co2spez_bezirk <- list()
for (ii in 1:12) {
  g_co2spez_bezirk[[ii]] <- points_line_lm(input_data = bezirke_spez_co2,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=ymax,
                                       x_eq = 2010,
                                       y_eq = 0.5*ymax,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],#Here put bezirk_name[ii]
                                       xlab = "Jahr",
                                       ylab = yspezco2)
}
require(grid)
require(gridExtra)
grid.arrange(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
bezirke_spez_co2
```



```{r,fig.width=10,fig.height=7}
createTable(bezirke_spez_co2[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Spezifische CO2 Emissionen nach Bezirken (kg / q.m.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(bezirke_spez_co2[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Spezifische CO2 Emissionen nach Bezirken (kg / q.m.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```





```{r}
i_subsubsection <- i_subsubsection + 1
```


### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, flächenbezogene co2 Emission aus der Beheizung von Wohnraum im Jahr 2018 in kg/m2 [AN]


**2018 values for the specific CO2 emission in each bezirk**

```{r}
bezirke_spez_co2_2018 <- bezirke_spez_co2[bezirke_spez_co2$abrechnungsjahr==2018 , ]
#bezirke_spez_co2_2018
```

```{r}
bezirke_spezco2_2018 <- as.data.frame(t(bezirke_spez_co2_2018))
bezirke_spezco2_2018$bezirk <- row.names(bezirke_spezco2_2018)
names(bezirke_spezco2_2018) <- c("wert","bezirk")
bezirke_spezco2_2018 <- bezirke_spezco2_2018[bezirke_spezco2_2018$bezirk!="abrechnungsjahr" , ]
#bezirke_spezco2_2018
```

Here it makes more sense to put in the values of the linear trend...

```{r}
linearizer <- function(obj,dropCols,xVar) {
  obj_new <- obj[ , !(names(obj) %in% dropCols)]
  feature_list <- names(obj_new)[ !(names(obj_new) %in% c(dropCols,xVar)) ]
  storage <- list()
  for (feature in feature_list) {
    storage[[feature]] <- lm(get(feature) ~ get(xVar) , data = obj)
    obj_new[[feature]] <- as.numeric(predict(storage[[feature]] , newdata = obj))
  }
  return(obj_new)
}
```


```{r}
bezirke_spez_co2_linear <- linearizer(bezirke_spez_co2 , dropCols = NULL , xVar = "abrechnungsjahr")
```




```{r}
bezirke_spez_co2_linear_2018 <- bezirke_spez_co2_linear[bezirke_spez_co2_linear$abrechnungsjahr==2018 , ]
bezirke_spezco2_linear_2018 <- as.data.frame(t(bezirke_spez_co2_linear_2018))
bezirke_spezco2_linear_2018$bezirk <- row.names(bezirke_spezco2_linear_2018)
names(bezirke_spezco2_linear_2018) <- c("wert","bezirk")
bezirke_spezco2_linear_2018 <- bezirke_spezco2_linear_2018[!(bezirke_spezco2_linear_2018$bezirk%in%c("abrechnungsjahr","total")) , ]
#bezirke_spezco2_linear_2018
```



```{r}
plot_spezCO2_2018 <- function(obj,plot_title) {
  obj$bezirk <- get_BezirkNames(obj$bezirk)
  obj$bezirk <- factor(obj$bezirk , 
      levels = obj$bezirk[order(obj$wert)])
  return(
    ggplot(data=obj,aes(x=bezirk,y=wert,fill=wert))+geom_bar(stat="identity")+scale_fill_gradient(
      low="green",high="red"
    )+theme(legend.position="none",axis.text.x=element_text(angle=45,hjust=1))+labs(x=" ",y=yspezco2,title=plot_title)#+coord_flip()
  )
}
```

```{r}
plot_spezCO2_2018(obj = bezirke_spezco2_linear_2018 , 
                  plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen 2018, alle Wohngebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
bezirke_spezco2_linear_2018
```

```{r,fig.width=3.5,fig.height=7}
#createTable(obj = bezirke_spezco2_linear_2018[, c("bezirk","wert")],
#            fontSize = 10,
#            isHeader = TRUE,
#            headerName = "Berlin, alle Wohngeb?ude,\nCO2 Emissionen (2018)",
#            columnNames = c("Bezirk","kg / q.m."),
#            columnWidths = c(1,1),
#            columnsToRound = "kg / q.m."
#)
createTable2018 <- function(obj,
                            headerName,
                            columnNames,
                            columnWidths,
                            columnsToRound=NULL,
                            roundOffTo=2) {
  require(gridExtra)
  require(grid)  
  names(obj) <- columnNames
  obj$Bezirk <- get_BezirkNames(obj$Bezirk)
  obj[, columnsToRound] <- data.frame(sapply(obj[, columnsToRound] , function(x) round(x,roundOffTo)))
  t0 <- ttheme_default()
  tab01 <- tableGrob(obj , theme=t0 , rows=NULL)
  header <- tableGrob(obj[1 , 1] , theme=t0, rows=NULL, cols=headerName)
  
  jn <- gtable_combine(header[1,],tab01,along=2)
  jn$widths <- columnWidths
  jn$layout[1:2,c("l","r")] <- list(1,ncol(obj))
  
  grid.newpage()
  grid.draw(jn)
  
}

createTable2018(obj = bezirke_spezco2_linear_2018[, c("bezirk","wert")],
            headerName = "Berlin, alle Wohngebäude,\nCO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```






```{r}
i_subsubsection <- i_subsubsection + 1
```


### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, flächenbezogene co2 Emission aus Beheizung von Wohnraum nach Stadtbezirken, 2002-2008, 2002=100

The per unit area co2 emission when the 2002 value is 100.

`spez_co2_emission` contains the berlin values of the specific co2 emission.
```{r}
#spez_co2_emission
```

```{r}
get2002as100 <- function(obj,dropCols) {
  isNotDropCol <- !(names(obj) %in% dropCols)
  for (xvar in names(obj)[isNotDropCol]) {
    obj[[xvar]] <- 100*obj[[xvar]]/obj[[xvar]][1]
  }
  return(obj)
}
```


```{r}
#get2002as100(spez_co2_emission , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = get2002as100(spez_co2_emission , "abrechnungsjahr"),
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=110,
               x_eq = 2010,
               y_eq = 60,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, alle Wohngebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = " ")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
get2002as100(spez_co2_emission , "abrechnungsjahr")
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = get2002as100(spez_co2_emission , "abrechnungsjahr"),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude,\nSpezifische CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Alle Stadtbezirke, MFH + 1-2 FH, flächenbezogene CO2 Emissionen aus der Beheizung von Wohnraum, Entwicklung 2002-2018 und Niveau 2018 (Rang-folge)

**Specific CO2 emission in bezirk X in 2018 - Specific CO2 emission in Berlin in 2018**

Take the Berlin specific CO2 emission for 2018 as the baseline, Subtract from this the 2018 value of specific co2 emission of Stadtbezirk X. Do for all the bezirks and make a barplot.

Make a linear trend of `spez_co2_emission`. This is the value for Berlin total. The 2018 value is the baseline.
`bezirke_spezco2_linear_2018` gives the 2018 values of the linear trend for the bezirke.

First find the linear trend:
```{r}
spez_co2_emission_linear <- linearizer(spez_co2_emission,dropCols=NULL,xVar="abrechnungsjahr")
spez_co2_emission_linear_2018 <- spez_co2_emission_linear$spez_co2[spez_co2_emission_linear$abrechnungsjahr==2018]
#spez_co2_emission_linear_2018
```



```{r}
#bezirke_spezco2_linear_2018
```


```{r}
bezirke_spezco2_linear_2018$dev_from_berlin <- bezirke_spezco2_linear_2018$wert - spez_co2_emission_linear_2018
```

```{r}
#bezirke_spezco2_linear_2018
```


```
bezirke_spezco2_linear_2018$bezirk <- factor(
      bezirke_spezco2_linear_2018$bezirk , 
      levels = bezirke_spezco2_linear_2018$bezirk[order(bezirke_spezco2_linear_2018$dev_from_berlin)])

ggplot(data=bezirke_spezco2_linear_2018,aes(x=bezirk,y=dev_from_berlin,fill=dev_from_berlin))+geom_bar(stat="identity")+scale_fill_gradient(
  low="green",high="red"
)+theme(legend.position="none",axis.text.x=element_text(angle=45,hjust=1))+labs(x=" ")#+coord_flip()
```

```{r}
plot_devFromBerlin2018 <- function(obj,
                                   plot_title=NULL,
                                   ylabel = NULL) {
  obj$bezirk <- get_BezirkNames(obj$bezirk)
  obj$bezirk <- factor(obj$bezirk , levels = obj$bezirk[order(obj$dev_from_berlin)])
  return(
    ggplot(data=obj,aes(x=bezirk,y=dev_from_berlin,fill=dev_from_berlin))+geom_bar(stat="identity")+scale_fill_gradient(
  low="green",high="red"
)+theme(legend.position="none",axis.text.x=element_text(angle=45,hjust=1))+labs(x=" ",y=ylabel,title=plot_title)#+coord_flip()
  )
}

plot_devFromBerlin2018(bezirke_spezco2_linear_2018,
                       plot_title = changeCO2_to_CO_2("Abweichung von Berlin 2018, Spezifische CO2 Emissionen, alle Wohngebäude"),
                       ylabel = yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```



```{r,results = showResults}
bezirke_spezco2_linear_2018
```


```{r,fig.width=3.5,fig.height=7}
createTable2018(obj = bezirke_spezco2_linear_2018[, c("bezirk","dev_from_berlin")],
            headerName = "Bezirke, alle Wohngebäude,\nCO2 Emissionen (2018)\nAbweichung von Berlin",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, MFH + 1-2 FH, durchschnittliche Emissionsminderung je qm Nutzfläche im Zeitraum 2002-2018

**Berlin, specific co2 emission with 2012 value as the reference**

Take the 2012 value of specific co2 emission as the base line. Plot the changes of each year with respect to this value.

`spez_co2_emission` contains the berlin specific co2 emissions.

```{r}
changeFrom2012 <- function(obj) {
  wert2012 <- obj$spez_co2[obj$abrechnungsjahr==2012]
  obj$delta2012 <- obj$spez_co2 - wert2012
  return(obj)
}
barPlot_delta2012 <- function(obj,ylabel=NULL,plot_title=NULL) {
  obj$abrechnungsjahr <- as.character(obj$abrechnungsjahr)
  require(ggplot2)
  return(
    ggplot(data=obj,aes(x=abrechnungsjahr,y=delta2012,fill=delta2012))+geom_bar(stat="identity")+scale_fill_gradient(
      low="green",high="red"
    )+theme(legend.position="none",axis.text.x=element_text(angle=45,hjust=1))+labs(x=" ",y=ylabel,title=plot_title)
  )
}
```

```{r}
#changeFrom2012(spez_co2_emission)
```

```{r}
barPlot_delta2012(changeFrom2012(spez_co2_emission),
                  ylabel = yspezco2,
                  plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen, Berlin, alle Wohngebäude, zentriert um 2012"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
changeFrom2012(spez_co2_emission)
```



```{r,fig.width=2.5,fig.height=7}
createTableZentriertUm2012 <- function(obj,
                            headerName,
                            columnNames,
                            columnWidths,
                            columnsToRound=NULL,
                            roundOffTo=2) {
  require(gridExtra)
  require(grid)  
  names(obj) <- columnNames
  obj[, columnsToRound] <- data.frame(sapply(obj[, columnsToRound] , function(x) round(x,roundOffTo)))
  t0 <- ttheme_default()
  tab01 <- tableGrob(obj , theme=t0 , rows=NULL)
  header <- tableGrob(obj[1 , 1] , theme=t0, rows=NULL, cols=headerName)
  
  jn <- gtable_combine(header[1,],tab01,along=2)
  jn$widths <- columnWidths
  jn$layout[1:2,c("l","r")] <- list(1,ncol(obj))
  
  grid.newpage()
  grid.draw(jn)
  
}
createTableZentriertUm2012(changeFrom2012(spez_co2_emission)[,c("abrechnungsjahr","delta2012")],
            headerName = "Berlin, alle Wohngebäude,\nSpezifiscche CO2 Emissionen\nZentriert um 2012",
            columnNames =  c("Jahr","kg / q.m."),
            columnWidths = rep(1,2),
            columnsToRound = c("kg / q.m.")
)
```



```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection` Emission pro Einwohner

```{r}
i_subsubsection <- 1
```


### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, co2-Emission aus der Beheizung von Wohnraum pro Einwohner

```{r}
#converting data from wide to long: http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/
# look at the reshape2 option. id.vars has to be bezirk

#from:	Johannes Hengstenberg <johanneshengstenberg@gmail.com>
#to:	Bhaskar Kamble <kbhaskar.iitk@gmail.com>
#date:	Jun 17, 2019, 7:46 PM
#subject:	Population Data for the Bezirke


#from:	Johannes Hengstenberg <johanneshengstenberg@gmail.com>
#to:	Bhaskar Kamble <kbhaskar.iitk@gmail.com>
#date:	Jun 16, 2019, 3:09 PM
#subject:	Population of Berlin


#Now you know the population, so can find per capita co2 emissions.
```



```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getBerlinBezirkPopulation.R")
bezirk_population <- getBerlinBezirkPopulation()
#bezirk_population
```

```{r}
bezirk_population <- getRowSums(bezirk_population , dropCols = "abrechnungsjahr")
#bezirk_population
```





```{r}
berlin_co2_percapita <- 1e6*berlin_co2_all$total / bezirk_population$total
#bezirk_co2_percapita$abrechnungsjahr <- 2002:2018
berlin_co2_percapita <- data.frame( abrechnungsjahr = 2002:2018 , co2_percapita = berlin_co2_percapita)
#berlin_co2_percapita
```

```{r}
points_line_lm(input_data = berlin_co2_percapita,
               xVar = "abrechnungsjahr",
               yVar = "co2_percapita",
               ymin=0,
               ymax=max(berlin_co2_percapita$co2_percapita),
               x_eq = 2010,
               y_eq = 500,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, alle Wohngebäude"),
               xlab = "Jahr",
               ylab = yco2perhead)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
berlin_co2_percapita
```


```{r,fig.width=2.5,fig.height=7}
createTable(obj = berlin_co2_percapita,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, \nPro Kopf CO2 Emissionen",
            columnNames = c("Jahr","kilo t."),
            columnWidths = c(1,1),
            columnsToRound = "kilo t."
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, MFH + 1-2 FH, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner



```{r}
#berlin_co2_all
```

```{r}
#bezirk_population
```


```{r}
berlin_bezirke_all_co2perhead <- 1e6*berlin_co2_all/bezirk_population
berlin_bezirke_all_co2perhead$abrechnungsjahr <- 2002:2018
#berlin_bezirke_all_co2perhead
```

```{r}
plot_reqdColumns(berlin_bezirke_all_co2perhead,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_bezirke_all_co2perhead)[!(names(berlin_bezirke_all_co2perhead) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "co2 kg/head",
                 plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen von Stadtbezirken, alle Wohngebäude"),
                 xlabel = "Jahr",
                 ylabel = yco2perhead)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.height=10,fig.width=10}
max_co2perhead_value <- max(berlin_bezirke_all_co2perhead[ , names(berlin_bezirke_all_co2perhead)[!(names(berlin_bezirke_all_co2perhead) %in% c("abrechnungsjahr","total"))]])
require(ggplot2)
g_co2perhead_bezirk <- list()
for (ii in 1:12) {
  g_co2perhead_bezirk[[ii]] <- points_line_lm(input_data = berlin_bezirke_all_co2perhead,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=max_co2perhead_value,
                                       x_eq = 2010,
                                       y_eq = 0.5*max_co2perhead_value,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = yco2perhead)
}
require(grid)
require(gridExtra)
grid.arrange(g_co2perhead_bezirk[[1]],g_co2perhead_bezirk[[2]],g_co2perhead_bezirk[[3]],g_co2perhead_bezirk[[4]],
             g_co2perhead_bezirk[[5]],g_co2perhead_bezirk[[6]],g_co2perhead_bezirk[[7]],g_co2perhead_bezirk[[8]],
             g_co2perhead_bezirk[[9]],g_co2perhead_bezirk[[10]],g_co2perhead_bezirk[[11]],g_co2perhead_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2perhead_bezirk[[1]],g_co2perhead_bezirk[[2]],g_co2perhead_bezirk[[3]],g_co2perhead_bezirk[[4]],
             g_co2perhead_bezirk[[5]],g_co2perhead_bezirk[[6]],g_co2perhead_bezirk[[7]],g_co2perhead_bezirk[[8]],
             g_co2perhead_bezirk[[9]],g_co2perhead_bezirk[[10]],g_co2perhead_bezirk[[11]],g_co2perhead_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
berlin_bezirke_all_co2perhead
```



```{r,fig.width=10,fig.height=7}
createTable(berlin_bezirke_all_co2perhead[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Pro Kopf CO2 Emissionen nach Bezirken (kg)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_bezirke_all_co2perhead[ , c(1,8:13)],
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Pro Kopf CO2 Emissionen nach Bezirken (kg)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, co2-Emission pro Einwohner aus der Beheizung von Wohnraum, 2002-2018, 2002=100 



```{r}
berlin_co2_percapita_2002as100 <- get2002as100(berlin_co2_percapita , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = berlin_co2_percapita_2002as100,
               xVar = "abrechnungsjahr",
               yVar = "co2_percapita",
               ymin=0,
               ymax=max(berlin_co2_percapita_2002as100$co2_percapita),
               x_eq = 2010,
               y_eq = 70,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, alle Wohngebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = "kg")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
berlin_co2_percapita_2002as100
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = berlin_co2_percapita_2002as100,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude,\nPro Kopf CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, MFH + 1-2 FH, CO2-Emission pro Einwohner aus der Beheizung von Wohnraum, 2002 - 2018, 2002 = 100

*One Graph: CO2 Emissions with 2002 value = 100 for each Bezirk. All 12 lines on the same plot.*



```{r}
#berlin_bezirke_all_co2perhead
```

```{r}
get_bezirk_prohead_2002As100 <- function(obj) {
   for (var in names(obj)) {
     wert2002 <- obj[[var]][obj$abrechnungsjahr == 2002]
     obj[[var]] <- obj[[var]]/wert2002
     obj$abrechnungsjahr <- 2002:2018
   }
  obj <- 100*obj
  obj$abrechnungsjahr <- 2002:2018
  return(obj)
}
bezirk_prohead_2002As100_all <- get_bezirk_prohead_2002As100(berlin_bezirke_all_co2perhead)
```


```{r}
plot_reqdColumns(bezirk_prohead_2002As100_all,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirk_prohead_2002As100_all)[!(names(bezirk_prohead_2002As100_all) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "co2 pro head, 2002=100",
                 xlabel="Jahr",
                 ylabel = NULL,
                 plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Stadtbezirken, alle Wohngebäude, 2002 Wert = 100"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```








```{r}
gg_co2perhead_2002As100 <- plot_bezirkeGridPlot(bezirk_prohead_2002As100_all,ylabel="")
```

```{r,fig.width=10,fig.height=10}
#gg_co2perhead_2002As100[[1]]
require(grid)
require(gridExtra)
grid.arrange(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)

```


```{r,results = showResults}
bezirk_prohead_2002As100_all
```


```{r,fig.width=10,fig.height=7}
createTable(bezirk_prohead_2002As100_all[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```



```{r,fig.width=10,fig.height=7}
createTable(bezirk_prohead_2002As100_all[,c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, co2-Emission aus der Beheizung von Wohnraum pro Einwohner, Niveau im Jahr 2018 in t/Einwohner






```{r}
bezirk_co2_percapita <- 1e6*berlin_co2_all/bezirk_population
bezirk_co2_percapita$abrechnungsjahr <- 2002:2018
#bezirk_co2_percapita
```



```{r}
bezirk_co2_percapita_linear <- linearizer(bezirk_co2_percapita,dropCols = NULL , xVar = "abrechnungsjahr")
#bezirk_co2_percapita_linear
```



```{r}
bezirk_co2_percapita_linear_2018 <- bezirk_co2_percapita_linear[bezirk_co2_percapita_linear$abrechnungsjahr==2018 , ]
bezirk_co2_percapita_linear_2018 <- as.data.frame(t(bezirk_co2_percapita_linear_2018))
bezirk_co2_percapita_linear_2018$bezirk <- row.names(bezirk_co2_percapita_linear_2018)
names(bezirk_co2_percapita_linear_2018) <- c("wert","bezirk")
bezirk_co2_percapita_linear_2018 <- bezirk_co2_percapita_linear_2018[bezirk_co2_percapita_linear_2018$bezirk!="abrechnungsjahr" , ]
bezirk_co2_percapita_linear_2018 <- bezirk_co2_percapita_linear_2018[bezirk_co2_percapita_linear_2018$bezirk!="total" , ]
#bezirk_co2_percapita_linear_2018
```



```{r}
plot_co2perhead_2018 <- function(obj,
                                 ylabel = NULL,
                                 plot_title = NULL) {
  obj$bezirk <- get_BezirkNames(obj$bezirk)
  obj$bezirk <- factor(obj$bezirk , levels = obj$bezirk[order(obj$wert)])
  return(
    ggplot(data=obj,aes(x=bezirk,y=wert,fill=wert))+geom_bar(stat="identity")+theme(legend.position="none",axis.text.x=element_text(angle=45,hjust=1))+labs(x="",y=ylabel,title=plot_title)+scale_fill_gradient(
  low="green",high="red"
)
  )
}
plot_co2perhead_2018(bezirk_co2_percapita_linear_2018,
                     ylabel = yco2perhead,
                     plot_title = changeCO2_to_CO_2("CO2 Emissionen pro Einwohner in Stadtbezirken 2018, alle Wohngebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
bezirk_co2_percapita_linear_2018
```

```{r,fig.width=3.5,fig.height=7}
createTable2018(obj = bezirk_co2_percapita_linear_2018[, c("bezirk","wert")],
            headerName = "Bezirke, alle Wohngebäude,\npro Kopf CO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg"),
            columnWidths = c(2,1),
            columnsToRound = "kg"
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, MFH + 1-2 FH, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner, Veränderung 2002/2018 in Prozent


*(Zwei Grafiken: absolute values and percentage values of change compared to 2002 and 2018 values as grouped bar charts.)
Group barchart of only 2002 and 2018 values for each city district - either absolute values and percentage.*



```{r}
#Use `bezirk_co2_percapita_linear`. This is the linear version of `bezirk_co2_percapita`, which is the same as `berlin_bezirke_all_co2perhead`.
#bezirk_co2_percapita_linear
```



```{r}
is_2002_or_2018 <- bezirk_co2_percapita_linear$abrechnungsjahr==2002 |
  bezirk_co2_percapita_linear$abrechnungsjahr==2018

bezirk_co2_percapita_linear_20022018 <- bezirk_co2_percapita_linear[ is_2002_or_2018 , ]
#bezirk_co2_percapita_linear_20022018
```

```{r}
require(reshape2)
data_long <- melt(bezirk_co2_percapita_linear_20022018,id.vars="abrechnungsjahr")
names(data_long) <- c("abrechnungsjahr","bezirk","wert")
data_long <- data_long[ data_long$bezirk!="total" , ]
```

```{r}
plot_groupBar <- function(obj,yVar,xlabel=NULL,ylabel=NULL,plot_title=NULL) {
  obj$bezirk <- get_BezirkNames(as.character(obj$bezirk))
  obj$abrechnungsjahr <- as.factor(as.character(obj$abrechnungsjahr))  
  return(
    ggplot(obj , aes(x=bezirk,y=get(yVar),fill=abrechnungsjahr))+geom_bar(stat="identity", position=position_dodge()
    )+ scale_fill_discrete(name="Jahr") +theme(axis.text.x=element_text(angle=45,hjust=1))+labs(x=" ",
                                                                                                y=ylabel,
                                                                                                title=plot_title)
  )
}
plot_groupBar(data_long,
              "wert",
              NULL,
              yco2perhead,
              changeCO2_to_CO_2("CO2 Emissionen pro Einwohner, 2002 und 2018, alle Wohngebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r}
plot_groupBarPercent <- function(obj,
                                 xlabel = NULL,
                                 ylabel = NULL,
                                 plot_title = NULL) {
  values2002 <- obj$wert[obj$abrechnungsjahr == 2002]
  obj$percentchange <- rep(values2002, each = 2)
  obj$percentchange <- 100*obj$wert/obj$percentchange
  g_return <- plot_groupBar(obj,"percentchange",xlabel=xlabel,ylabel=ylabel,plot_title=plot_title)
  return(g_return)
}
```



```{r}
plot_groupBarPercent(data_long,
                     xlabel=NULL,
                     ylabel = NULL,
                     plot_title = changeCO2_to_CO_2("pro Kopf CO2 Emissionen 2018, 2002 Wert = 100"))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
data_long
```

```{r,results = showResults}
require(reshape2)
data_wide <- dcast(data_long , bezirk ~ abrechnungsjahr , value.var = "wert")
data_wide$bezirk <- as.character(data_wide$bezirk)
data_wide
```

```{r,fig.width=6,fig.height=5}
createTable20022018 <- function(obj,
                            headerName,
                            columnNames,
                            columnWidths,
                            columnsToRound=NULL,
                            roundOffTo=2) {
  require(gridExtra)
  require(grid)  
  names(obj) <- columnNames
  obj$Bezirk <- get_BezirkNames(obj$Bezirk)
  obj[, columnsToRound] <- data.frame(sapply(obj[, columnsToRound] , function(x) round(x,roundOffTo)))
  t0 <- ttheme_default()
  tab01 <- tableGrob(obj , theme=t0 , rows=NULL)
  header <- tableGrob(obj[1 , 1] , theme=t0, rows=NULL, cols=headerName)
  
  jn <- gtable_combine(header[1,],tab01,along=2)
  jn$widths <- columnWidths
  jn$layout[1:2,c("l","r")] <- list(1,ncol(obj))
  
  grid.newpage()
  grid.draw(jn)
  
}

createTable20022018(data_wide,
                    headerName = "Bezirke, Pro Kopf CO2 Emissionen, 2002 und 2018 Werte (kg)",
                    columnNames = c("Bezirk","2002","2018"),
                    columnWidths = c(3,2,2),
                    columnsToRound = c("2002","2018"))
```


```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection` Prognose



```{r}
i_subsubsection <- 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, MFH + 1-2 FH, Prognose der CO2-Emissionen aus Beheizung 2019-2030 in Mio. t (Trend Polynom 1. Grades)


```{r}
#berlin_co2_all
linmodel <- lm(total~abrechnungsjahr,data=berlin_co2_all)
```

$R^2$ für Polynom 1. Grades.

```{r}
summary(linmodel)$r.squared
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_lin <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(linmodel,newdata=from2002_till_2030)))
```

```{r}
b0_grad1 <- 0.001*round(as.numeric(linmodel$coefficients[1]) , 2)
b1_grad1 <- 0.001*round(as.numeric(linmodel$coefficients[2]) , 2)
eq_grad1 <- paste0("y = ", b1_grad1 , "x + ", b0_grad1)
ggplot(convert_kilo_to_megaton(prognose_lin,"abrechnungsjahr") , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title = "CO2 Emissionen in Berlin, alle Wohngebäude (Polynom 1. Grades)",y=yco2,x="Jahr"
)+annotate(geom="text",label=eq_grad1,x=2015,y=0.001*0.65*max(prognose_lin$pred),size=5) + ylim(0,0.001*max(prognose_lin$pred))+scale_x_continuous(breaks=seq(2002,2030,4))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results=showResults}
prognose_lin
```


```{r}
i_subsubsection <- i_subsubsection + 1
```


### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, MFH + 1-2 FH, Prognose der CO2-Emissionen aus Beheizung 2019-2030 in Mio. t (Trend Polynom 2. Grades)

```{r}
#berlin_co2_all
quadmodel <- lm(total~abrechnungsjahr+I(abrechnungsjahr^2),data=berlin_co2_all)
```

$R^2$ für Polynom 2. Grades.

```{r}
summary(quadmodel)$r.squared
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_quad <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(quadmodel,newdata=from2002_till_2030)))
```

```{r}
b0_grad2 <- round(as.numeric(quadmodel$coefficients[1]) , 2)
b1_grad2 <- round(as.numeric(quadmodel$coefficients[2]) , 2)
b2_grad2 <- round(as.numeric(quadmodel$coefficients[3]) , 2)
eq_grad2 <- paste0("y = ",b2_grad2,"x^2 + ",b1_grad2 , "x + ", b0_grad2)
ggplot(prognose_quad , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title = "CO2 Emissionen in Berlin, alle Wohngebäude (Polynom 2. Grades)",y="kilo t.",x="Jahr")+annotate(
  geom="text",label=eq_grad2,x=2015,y=0.65*max(prognose_quad$pred),size=5
  ) + ylim(0,max(prognose_quad$pred))+scale_x_continuous(breaks=seq(2002,2030,4))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results=showResults}
prognose_quad
```


```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection` Diskussion


```{r}
i_section <- i_section+1
i_subsection <- 1
i_subsubsection <- 1
```

# `r i_section`. Alle Stadtbezirke, CO2-Emissionen aus Beheizung, 1-2 Familiengebäude

## `r i_section`.`r i_subsection` Absolute Zahlen

```{r}
gtypeForFig <- "SFH"
```




### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, 1-2 Familiengebäude, co2-Emission aus der Beheizung von Wohnraum 2002-2018 in 1.000 t

```{r}
#alle_bezirke_co2$sfh
```

```{r}
berlin_co2_sfh <- getRowSums(alle_bezirke_co2$sfh , dropCols = "abrechnungsjahr")
#berlin_co2_sfh
```

```{r}
points_line_lm(input_data = berlin_co2_sfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(berlin_co2_sfh$total),
               x_eq = 2010,
               y_eq = 700,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("CO2 Emissionen in Berlin, 1-2 Familiengebäude"),
               xlab = "Jahr",
               ylab = yco2,
               slope_round_to = 3,
               kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_sfh[ , c("abrechnungsjahr" , "total")]
```

```{r,fig.width=7,fig.height=7}
#https://stackoverflow.com/questions/43714570/add-superscript-in-table-using-tablegrob
#https://r.789695.n4.nabble.com/Transferring-commas-in-character-vector-to-expression-td4670987.html
#https://groups.google.com/forum/m/#!msg/ggplot2/vga0PKjMBCo/5mH4sobYykkJ
createTable(obj = berlin_co2_sfh[, c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin~1-2~Familiengebäude~CO[2]~Emissionen:~No~commas~No~newlines.",
            columnNames = c("Jahr","kilo t."),
            columnWidths = c(1,1),
            columnsToRound = "kilo t.",
            parseHeader = TRUE
)
```



```{r}
co2_sfh_allebezirke_byET <- co2_allebezirke_byET$sfh
#co2_sfh_allebezirke_byET
```

```{r}
co2_sfh_allebezirke_byET_cumsums <- getCumSums(obj=co2_sfh_allebezirke_byET , dropCols=c("abrechnungsjahr","total"))
#co2_all_allebezirke_byET_cumsums
plot_byET(co2_sfh_allebezirke_byET_cumsums , xlabel = "Jahr" , ylabel = yco2 , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, 1-2 Familiengebäude, nach Energiträger"),kt_to_mt = TRUE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
co2_sfh_allebezirke_byET
```

```{r,fig.width=10,fig.height=7}
createTable(co2_sfh_allebezirke_byET,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Energieträgern (kilo t.)",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```



```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, 1-2 Familiengebäude, co2-emissionen aus der Beheizung von Wohnraum 2002-2018 summiert in 1.000 t



```{r}
berlin_co2_sfh_cumsums <- getCumSums(obj=berlin_co2_sfh , dropCols=c("abrechnungsjahr","total"))
plot_byBezirke(berlin_co2_sfh_cumsums , xlabel = "Jahr" , ylabel = yco2 , plottitle=changeCO2_to_CO_2("CO2 Emissionen in Berlin, 1-2 Familiengebäude, nach Bezirk"),kt_to_mt = TRUE)

figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_sfh
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, 1-2 Familiengebäude, co2-emissionen aus der Beheizung von Wohnraum 2002-2018 in Prozent

```{r}
co2_sfh_allebezirke_byET_prop <- find_proportions(co2_sfh_allebezirke_byET , drop_cols = c("abrechnungsjahr","total"))
co2_sfh_allebezirke_byET_prop_cumsums <- getCumSums(obj=co2_sfh_allebezirke_byET_prop , dropCols = "abrechnungsjahr")
plot_byET(co2_sfh_allebezirke_byET_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, 1-2 Familiengebäude, Anteile nach Energieträgern"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
co2_sfh_allebezirke_byET_prop
```

```{r,fig.width=8.75,fig.height=7}
createTable(co2_sfh_allebezirke_byET_prop,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen, Anteile nach Energieträgern (%)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom")
)
```

```{r}
berlin_co2_sfh_prop <- find_proportions(berlin_co2_sfh,drop_cols=c("abrechnungsjahr","total"))
berlin_co2_sfh_prop_cumsums <- getCumSums(berlin_co2_sfh_prop,dropCols="abrechnungsjahr")
plot_byBezirke(berlin_co2_sfh_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, 1-2 Familiengebäude, Anteile nach Bezirken"))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_sfh_prop
```


```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh_prop[ , c(1:6,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh_prop[ , c(7:12,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, 1-2 Familiengebäude, co2-emissionen aus der Beheizung von Wohnraum 2002-2018 in 1.000 t

```{r}
plot_reqdColumns(berlin_co2_sfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_co2_sfh)[!(names(berlin_co2_sfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2 Emissions",
                 plot_title = changeCO2_to_CO_2("CO2 Emissionen von Stadtbezirken, 1-2 Familiengebäude"),
                 xlabel = "Jahr",
                 ylabel = yco2,
                 kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.height=10,fig.width=10}
gg_co2_sfh <- plot_bezirkeGridPlot(berlin_co2_sfh,ylabel=yco2,slope_round_to = 4,kt_to_mt = TRUE)
require(grid)
require(gridExtra)
grid.arrange(gg_co2_sfh[[1]],gg_co2_sfh[[2]],gg_co2_sfh[[3]],gg_co2_sfh[[4]],
             gg_co2_sfh[[5]],gg_co2_sfh[[6]],gg_co2_sfh[[7]],gg_co2_sfh[[8]],
             gg_co2_sfh[[9]],gg_co2_sfh[[10]],gg_co2_sfh[[11]],gg_co2_sfh[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2_sfh[[1]],gg_co2_sfh[[2]],gg_co2_sfh[[3]],gg_co2_sfh[[4]],
             gg_co2_sfh[[5]],gg_co2_sfh[[6]],gg_co2_sfh[[7]],gg_co2_sfh[[8]],
             gg_co2_sfh[[9]],gg_co2_sfh[[10]],gg_co2_sfh[[11]],gg_co2_sfh[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
berlin_co2_sfh
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, 1-2 Familiengebäude, co2-emissionen aus der Beheizung von Wohnraum 2002-2018, Veränderung in Prozent

**(CO2 emitted by a bezirk for a particular year - Average CO2 emitted by a bezirk in particular year)/(Average CO2 emitted by a bezirk in particular year) times 100**

```{r}
berlin_co2_sfh_devFromMean <- getDeviationsFromMean(berlin_co2_sfh,
                                                    xVar = "abrechnungsjahr",
                                                    colsToAvgOver = names(berlin_co2_sfh)[
                                                      !(names(berlin_co2_sfh
                                                              ) %in% c("abrechnungsjahr","total"))]
)
```

```{r}
ymin <- min(berlin_co2_sfh_devFromMean[ , 
                                        names(berlin_co2_sfh_devFromMean)[
                                          !(names(berlin_co2_sfh_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
ymax <- max(berlin_co2_sfh_devFromMean[ , 
                                        names(berlin_co2_sfh_devFromMean)[
                                          !(names(berlin_co2_sfh_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
#plotDevFromMean(berlin_co2_all_devFromMean,"abrechnungsjahr","mitte",yMin=yMin,yMax=yMax)
g_co2dev_bezirk <- list()
for (ii in 1:12) {
  g_co2dev_bezirk[[ii]] <- plotDevFromMean(input_data = berlin_co2_sfh_devFromMean,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=ymin,
                                       ymax=ymax,
                                       ylabel="Abweichung vom Mittelwert (%)",
                                       plot_title = bezirk_name[ii])
}
```

```{r,fig.width=10,fig.height=10}
require(grid)
require(gridExtra)
grid.arrange(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
berlin_co2_sfh_devFromMean
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh_devFromMean[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken, Abweichung vom jährlichen Mittelwert (%)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(berlin_co2_sfh_devFromMean[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, CO2 Emissionen nach Bezirken, Abweichung vom jährlichen Mittelwert (%)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Stadtbezirke, 1-2 Familiengebäude, Veränderung der co2-emissionen aus der Beheizung von Wohnraum 2002-2018 in Prozent

*Skip this

```{r}
i_subsubsection <- 1
i_subsection <- i_subsection+1
```


## `r i_section`.`r i_subsection`. Flächenbezug

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, 1-2 Familiengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum 2002 - 2018 in kg/m2[AN]

```{r}
bezirk_areas_sfh$abrechnungsjahr <- 2002:2018
#bezirk_areas_sfh
```


```{r}
spz_co2_sfh <- 1e6*berlin_co2_sfh$total/bezirk_areas_sfh$total
spez_co2_sfh <- data.frame(abrechnungsjahr=2002:2018 , spez_co2 = spz_co2_sfh )

points_line_lm(input_data = spez_co2_sfh,
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=max(spez_co2_sfh$spez_co2),
               x_eq = 2010,
               y_eq = 35,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, 1-2 Familiengebäude"),
               xlab = "Jahr",
               ylab = yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
#                       whatToSave = whatToSave)
```

```{r,results = showResults}
spez_co2_sfh
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = spez_co2_sfh[, c("abrechnungsjahr","spez_co2")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, \nSpezifische CO2 Emissionen",
            columnNames = c("Jahr","kg / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kg / q.m."
)
```

```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, flächenbezogene CO2-Emission aus Beheizung von Wohnraum 2002 - 2008 in kg/m2[AN]

```{r}
bezirke_spez_co2_sfh <- 1e6*berlin_co2_sfh/bezirk_areas_sfh
bezirke_spez_co2_sfh$abrechnungsjahr <- 2002:2018
```



```{r}
plot_reqdColumns(bezirke_spez_co2_sfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirke_spez_co2_sfh)[!(names(bezirke_spez_co2_sfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2 Emissions in kg/m2",
                 xlabel = "Jahr",
                 ylabel = yspezco2,
                 plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen von Stadtbezirken, 1-2 Familiengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
#                       whatToSave = whatToSave)
```


```{r,fig.width=10,fig.height=10}
reqdCols <- names(bezirke_spez_co2_sfh)[!(names(bezirke_spez_co2_sfh) %in% c("abrechnungsjahr" , "total"))]
ymax <- max(bezirke_spez_co2_sfh [ , reqdCols])
g_co2spez_bezirk <- list()
for (ii in 1:12) {
  g_co2spez_bezirk[[ii]] <- points_line_lm(input_data = bezirke_spez_co2_sfh,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=ymax,
                                       x_eq = 2010,
                                       y_eq = 0.5*ymax,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = yspezco2)
}
require(grid)
require(gridExtra)
grid.arrange(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
bezirke_spez_co2_sfh
```


```{r,fig.width=10,fig.height=7}
createTable(bezirke_spez_co2_sfh[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, spezifische CO2 Emissionen (kg / q.m.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=7}
createTable(bezirke_spez_co2_sfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, spezifische CO2 Emissionen (kg / q.m.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum im Jahr 2018 in kg/m2[AN]

**2018 values for the specific CO2 emission in each bezirk**



```{r}
bezirke_spez_co2_sfh_linear <- linearizer(bezirke_spez_co2_sfh , dropCols = NULL , xVar = "abrechnungsjahr")
```

```{r}
#bezirke_spez_co2_sfh_linear
```


```{r}
bezirke_spez_co2_sfh_linear_2018 <- bezirke_spez_co2_sfh_linear[bezirke_spez_co2_sfh_linear$abrechnungsjahr==2018 , ]
bezirke_spezco2_sfh_linear_2018 <- as.data.frame(t(bezirke_spez_co2_sfh_linear_2018))
bezirke_spezco2_sfh_linear_2018$bezirk <- row.names(bezirke_spezco2_sfh_linear_2018)
names(bezirke_spezco2_sfh_linear_2018) <- c("wert","bezirk")
bezirke_spezco2_sfh_linear_2018 <- bezirke_spezco2_sfh_linear_2018[bezirke_spezco2_sfh_linear_2018$bezirk!="abrechnungsjahr" , ]
bezirke_spezco2_sfh_linear_2018 <- bezirke_spezco2_sfh_linear_2018[bezirke_spezco2_sfh_linear_2018$bezirk!="total" , ]
#bezirke_spezco2_sfh_linear_2018
```

```{r}
plot_spezCO2_2018(obj = bezirke_spezco2_sfh_linear_2018 , 
                  plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen 2018, 1-2 Familiengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
bezirke_spezco2_sfh_linear_2018
```

```{r,fig.width=3.5,fig.height=5}
createTable2018(obj = bezirke_spezco2_sfh_linear_2018[, c("bezirk","wert")],
            headerName = "Berlin, 1-2 Familingebäude,\nCO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```



```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, 1-2 Familiengebäude, flächenbezogene CO2-Emission aus Beheizung von Wohnraum nach Stadtbezirken, 2002 - 2008, 2002 = 100

```{r}
#get2002as100(spez_co2_sfh , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = get2002as100(spez_co2_sfh , "abrechnungsjahr"),
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=110,
               x_eq = 2010,
               y_eq = 60,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, 1-2 Familiengebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = " ")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
get2002as100(spez_co2_sfh , "abrechnungsjahr")
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = get2002as100(spez_co2_sfh , "abrechnungsjahr"),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude,\nspezifische CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```


```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Alle Stadtbezirke, 1-2 Familiengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum, Entwicklung 2002 - 2018 und Niveau 2018 (Rangfolge)


**Specific CO2 emission in bezirk X in 2018 - Specific CO2 emission in Berlin in 2018**


```{r}
spez_co2_sfh_linear <- linearizer(spez_co2_sfh,dropCols=NULL,xVar="abrechnungsjahr")
spez_co2_sfh_linear_2018 <- spez_co2_sfh_linear$spez_co2[spez_co2_sfh_linear$abrechnungsjahr==2018]
#spez_co2_sfh_linear_2018
```

```{r}
#bezirke_spezco2_sfh_linear_2018
```

```{r}
bezirke_spezco2_sfh_linear_2018$dev_from_berlin <- bezirke_spezco2_sfh_linear_2018$wert - spez_co2_sfh_linear_2018
```

```{r}
#bezirke_spezco2_sfh_linear_2018
```

```{r}
plot_devFromBerlin2018(bezirke_spezco2_sfh_linear_2018,
                       changeCO2_to_CO_2("Spezifische CO2 Emissionen, Abweichung von Berlin 2018, 1-2 Familiengebäude"),
                       yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```



```{r,results = showResults}
bezirke_spezco2_sfh_linear_2018
```

```{r,fig.width=3.5,fig.height=6}
createTable2018(obj = bezirke_spezco2_sfh_linear_2018[, c("bezirk","dev_from_berlin")],
            headerName = "Bezirke, 1-2 Familiengebäude,\nCO2 Emissionen (2018)\nAbweichung von Berlin",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```

```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, 1-2 Familiengebäude, durchschnittliche Emissionsminderung je qm Nutzfläche im Zeitraum 2012 - 2018

**Berlin, specific co2 emission with 2012 value as the reference**


```{r}
barPlot_delta2012(changeFrom2012(spez_co2_sfh) , yspezco2 , changeCO2_to_CO_2("Spezifische CO2 Berlin, 1-2 Familiengebäude, zentriert um 2012"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
changeFrom2012(spez_co2_sfh)
```

```{r,fig.width=2.5,fig.height=7}
createTableZentriertUm2012(changeFrom2012(spez_co2_sfh)[,c("abrechnungsjahr","delta2012")],
            headerName = "Berlin, 1-2 Familiengebäude,\nSpezifiscche CO2 Emissionen\nZentriert um 2012",
            columnNames =  c("Jahr","kg / q.m."),
            columnWidths = rep(1,2),
            columnsToRound = c("kg / q.m.")
)
```

```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection`. Emission pro Einwohner

```{r}
i_subsubsection <- 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emission aus der Beheizung von Wohnraum pro Einwohner




```{r}
#**I'm using the micro census of 2014**
#Put the following into a function: `getCo2PerCapitaBezirk_byGtype_method1.R` and #`getCo2PerCapitaBezirk_byGtype_method1()`.
#source("D:/GITHUB_REPOS/co2emissions/Berlin/BezirkAnalysis/getBezirkPopulations_by_gtype_method1.R")
#bezirkPopulations_by_gtype <- getBezirkPopulations_by_gtype()
#bezirk_co2_percapita_sfh_v1 <- 1e6*berlin_co2_sfh / bezirkPopulations_by_gtype$SFH
#bezirk_co2_percapita_sfh_v1



#This is clearly giving an extremely low value for some of the bezirks for sfh (friedrichshain-kreuzberg and mitte).

#Do with the different method of finding avg number of people in each MFH and SFH flat. Write a function for the first method and the second method which finds the answer in a single step. Right now I find what fraction of ppl live in SFh and MFH in Berlin as a whole. Then I assume the same fractions hold in all Bezirke - but Friedrichshain-Kreuzberg has almost zero emissions from SFH buildings, because SFH buildings there do not exist.

#Here is the second method:
```

```{r}
source("/home/kbhaskar/Github_Repos/co2emissions/Berlin/BezirkAnalysis/getCo2PerCapitaBezirk_byGtype_method2.R")
bezirk_co2_percapita_sfh <- getCo2PerCapitaBezirk_byGtype_method2(berlin_co2_sfh , "SFH")
#bezirk_co2_percapita_sfh
```

```{r}
#From this you can also find the total SFH per capita co2 emission from the total column.
```

```{r}
points_line_lm(input_data = bezirk_co2_percapita_sfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin=0,
               ymax=max(bezirk_co2_percapita_sfh$total),
               x_eq = 2010,
               y_eq = 500,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, 1-2 Familiengebäude"),
               xlab = "Jahr",
               ylab = yco2perhead)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```
               

```{r,results = showResults}
bezirk_co2_percapita_sfh[ , c("abrechnungsjahr" , "total")]
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = bezirk_co2_percapita_sfh[ , c("abrechnungsjahr" , "total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude,\nPro Kopf CO2 Emissionen",
            columnNames = c("Jahr","kg"),
            columnWidths = c(1,1),
            columnsToRound = "kg"
)
```




```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emission aus der Beheizung von Wohnraum pro Einwohner




```{r}
plot_reqdColumns(bezirk_co2_percapita_sfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirk_co2_percapita_sfh)[!(names(bezirk_co2_percapita_sfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2PerCapita",
                 xlabel = "Jahr",
                 ylabel = yco2perhead,
                 plot_title = changeCO2_to_CO_2("CO2 Emissionen pro Kopf, 1-2 FH"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.width=10,fig.height=10}
gg_co2perhead_bezirke <- plot_bezirkeGridPlot(bezirk_co2_percapita_sfh , ylabel = yco2perhead)
require(grid)
require(gridExtra)
grid.arrange(gg_co2perhead_bezirke[[1]],gg_co2perhead_bezirke[[2]],gg_co2perhead_bezirke[[3]],gg_co2perhead_bezirke[[4]],
             gg_co2perhead_bezirke[[5]],gg_co2perhead_bezirke[[6]],gg_co2perhead_bezirke[[7]],gg_co2perhead_bezirke[[8]],
             gg_co2perhead_bezirke[[9]],gg_co2perhead_bezirke[[10]],gg_co2perhead_bezirke[[11]],gg_co2perhead_bezirke[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2perhead_bezirke[[1]],gg_co2perhead_bezirke[[2]],gg_co2perhead_bezirke[[3]],gg_co2perhead_bezirke[[4]],
             gg_co2perhead_bezirke[[5]],gg_co2perhead_bezirke[[6]],gg_co2perhead_bezirke[[7]],gg_co2perhead_bezirke[[8]],
             gg_co2perhead_bezirke[[9]],gg_co2perhead_bezirke[[10]],gg_co2perhead_bezirke[[11]],gg_co2perhead_bezirke[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
bezirk_co2_percapita_sfh
```


```{r,fig.width=10,fig.height=7}
createTable(bezirk_co2_percapita_sfh[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Bezirke, 1-2 Familiengebäude, Pro Kopf CO2 Emissionen (kg)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```


```{r,fig.width=10,fig.height=7}
createTable(bezirk_co2_percapita_sfh[ , c(1,8:13)],
            isHeader = TRUE,
            headerName = "Bezirke, 1-2 Familiengebäude, Pro Kopf CO2 Emissionen (kg)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```




```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emission pro Einwohner aus der Beheizung von Wohnraum, 2002 - 2008, 2002 = 100


```{r}
bezirk_co2_percapita_2002as100_sfh <- get2002as100(bezirk_co2_percapita_sfh , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = bezirk_co2_percapita_2002as100_sfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin=0,
               ymax=max(bezirk_co2_percapita_2002as100_sfh$total),
               x_eq = 2010,
               y_eq = 70,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, 1-2 Familiengebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = " ")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,fig.width=2.5,fig.height=7}
createTable(obj = bezirk_co2_percapita_2002as100_sfh[ , c("abrechnungsjahr","total")],
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude,\nPro Kopf CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```



```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner


```{r}
#bezirk_co2_percapita_2002as100_sfh
```


```{r}
plot_reqdColumns(bezirk_co2_percapita_2002as100_sfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirk_co2_percapita_2002as100_sfh)[!(names(bezirk_co2_percapita_2002as100_sfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "co2 pro head, 2002=100",
                 xlabel="Jahr",
                 ylabel = NULL,
                 plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Stadtbezirken, 1-2 Familiengebäude, 2002 Wert = 100"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```



```{r,fig.width=10,fig.height=10}
gg_co2perhead_2002As100 <- plot_bezirkeGridPlot(bezirk_co2_percapita_2002as100_sfh,ylabel="")
require(grid)
require(gridExtra)
grid.arrange(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
bezirk_co2_percapita_2002as100_sfh
```

```{r,fig.width=10,fig.height=7}
createTable(bezirk_co2_percapita_2002as100_sfh[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```


```{r,fig.width=10,fig.height=7}
createTable(bezirk_co2_percapita_2002as100_sfh[,c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```




```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner, Niveau im Jahr 2018 in t/Einwohner

**I need the data for the population in SFH and MFH buildings**

```{r}
#bezirk_co2_percapita_sfh
# Follow section 1.3.5 with the following steps. 

#a) Linearize the above with the function linearizer.

bezirk_co2_percapita_sfh_linear <- linearizer(bezirk_co2_percapita_sfh,dropCols = NULL , xVar = "abrechnungsjahr")

#Then do:
bezirk_co2_percapita_sfh_linear_2018 <- bezirk_co2_percapita_sfh_linear[bezirk_co2_percapita_sfh_linear$abrechnungsjahr==2018 , ]
bezirk_co2_percapita_sfh_linear_2018 <-  as.data.frame(t(bezirk_co2_percapita_sfh_linear_2018))
bezirk_co2_percapita_sfh_linear_2018$bezirk <- row.names(bezirk_co2_percapita_sfh_linear_2018)
names(bezirk_co2_percapita_sfh_linear_2018) <- c("wert","bezirk")
bezirk_co2_percapita_sfh_linear_2018 <- bezirk_co2_percapita_sfh_linear_2018[bezirk_co2_percapita_sfh_linear_2018$bezirk!="abrechnungsjahr" , ]
bezirk_co2_percapita_sfh_linear_2018 <- bezirk_co2_percapita_sfh_linear_2018[bezirk_co2_percapita_sfh_linear_2018$bezirk!="total" , ]

plot_co2perhead_2018(bezirk_co2_percapita_sfh_linear_2018,
                     ylabel = yco2perhead,
                     plot_title = changeCO2_to_CO_2("CO2 Emissionen pro Einwohner in Stadtbezirken 2018, 1-2 Familiengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
bezirk_co2_percapita_sfh_linear_2018
```


```{r,fig.width=3.5,fig.height=5}
createTable2018(obj = bezirk_co2_percapita_sfh_linear_2018[, c("bezirk","wert")],
            headerName = "Bezirke, 1-2 Familiengebäude,\npro Kopf CO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg"),
            columnWidths = c(2,1),
            columnsToRound = "kg"
)
```




```{r}
i_subsubsection <- i_subsubsection+1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, 1-2 Familiengebäude, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner, Veränderung 2002 / 2018 in Prozent

```{r}
is_2002_or_2018 <- bezirk_co2_percapita_sfh_linear$abrechnungsjahr==2002 |
  bezirk_co2_percapita_sfh_linear$abrechnungsjahr==2018

bezirk_co2_percapita_sfh_linear_20022018 <- bezirk_co2_percapita_sfh_linear[ is_2002_or_2018 , ]

require(reshape2)
data_long <- melt(bezirk_co2_percapita_sfh_linear_20022018,id.vars="abrechnungsjahr")
names(data_long) <- c("abrechnungsjahr","bezirk","wert")
data_long <- data_long[ data_long$bezirk!="total" , ]

plot_groupBar(data_long,
              "wert",
              NULL,
              yco2perhead,
              changeCO2_to_CO_2("CO2 Emissionen pro Einwohner, 2002 und 2018, 1-2 Familiengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r}
plot_groupBarPercent(data_long,
                     xlabel=NULL,
                     ylabel = NULL,
                     plot_title = changeCO2_to_CO_2("pro Kopf CO2 Emissionen 2018, 1-2 Familiengebäude, 2002 Wert = 100"))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
require(reshape2)
data_wide <- dcast(data_long , bezirk ~ abrechnungsjahr , value.var = "wert")
data_wide$bezirk <- as.character(data_wide$bezirk)
data_wide
```

```{r,fig.width=6,fig.height=4.5}
createTable20022018(data_wide,
                    headerName = "Berlin, 1-2 Familiengebäude, Pro Kopf CO2 Emissionen\n2002 und 2018 Werte (kg)",
                    columnNames = c("Bezirk","2002","2018"),
                    columnWidths = c(3,2,2),
                    columnsToRound = c("2002","2018"))
```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Prognose



```{r}
i_subsubsection <- 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection` Berlin, 1-2 Familiengebäude, Prognose der CO2-Emission aus der Beheizung 2019-2030 in Mio. t (Trend Polynom 1. und 2. Grades)

$R^2$ für Polynom 1. Grades

```{r}
linmodel_sfh <- lm(total~abrechnungsjahr,data=berlin_co2_sfh)
summary(linmodel_sfh)$r.squared
```

$R^2$ für Polynom 2. Grades
```{r}
quadmodel_sfh <- lm(total~abrechnungsjahr+I(abrechnungsjahr^2),data=berlin_co2_sfh)
summary(quadmodel_sfh)$r.squared
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_sfh_lin <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(linmodel_sfh,newdata=from2002_till_2030)))
b0_grad1 <- 0.001*round(as.numeric(linmodel_sfh$coefficients[1]) , 2)
b1_grad1 <- 0.001*round(as.numeric(linmodel_sfh$coefficients[2]) , 2)
eq_grad1 <- paste0("y = ", b1_grad1 , "x + ", b0_grad1)

ggplot(convert_kilo_to_megaton(prognose_sfh_lin,"abrechnungsjahr") , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title="CO2 Emissionen in Berlin, 1-2 Familiengebäude (Polynom 1. Grades)",y=yco2,x="Jahr")+annotate(
  geom="text",label=eq_grad1,x=2015,y=0.001*0.65*max(prognose_sfh_lin$pred),size=5
  ) + ylim(0,0.001*max(prognose_sfh_lin$pred))+scale_x_continuous(breaks=seq(2002,2030,4))

figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
b0_grad2 <- round(as.numeric(quadmodel_sfh$coefficients[1]) , 2)
b1_grad2 <- round(as.numeric(quadmodel_sfh$coefficients[2]) , 2)
b2_grad2 <- round(as.numeric(quadmodel_sfh$coefficients[3]) , 2)
eq_grad2 <- paste0("y = ",b2_grad2,"x^2 + ",b1_grad2 , "x + ", b0_grad2)
prognose_sfh_quad <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(quadmodel_sfh,newdata=from2002_till_2030)))
ggplot(prognose_sfh_quad , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title="CO2 Emissionen in Berlin, 1-2 Familiengebäude (Polynom 2. Grades)",y="kilo t.",x="Jahr")+annotate(
  geom="text",label=eq_grad2,x=2015,y=0.65*max(prognose_sfh_quad$pred),size=5
) + ylim(0,max(prognose_sfh_quad$pred))+scale_x_continuous(breaks=seq(2002,2030,4))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results=showResults}
prognose_sfh_lin
```

```{r,results=showResults}
prognose_sfh_quad
```


```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection`. Diskussion











```{r}
i_section <- i_section + 1
```

# `r i_section`. Alle Stadtbezirke, CO2-Emission aus Beheizung, Mehrfamiliengebäude

```{r}
i_subsection <- 1
```

## `r i_section`.`r i_subsection`. Absolute Zahlen 

```{r}
i_subsubsection <- 1
```


```{r}
gtypeForFig <- "MFH"
```


### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, Mehrfamiliengebäude, CO2-Emission aus der Beheizung von Wohnraum 2002 - 2018 in 1.000 t

```{r}
berlin_co2_mfh <- getRowSums(alle_bezirke_co2$mfh , dropCols = "abrechnungsjahr")
#berlin_co2_mfh
```

```{r}
points_line_lm(input_data = berlin_co2_mfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(berlin_co2_mfh$total),
               x_eq = 2010,
               y_eq = 2000,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("CO2 Emissionen in Berlin, Mehrfamiliengebäude"),
               xlab = "Jahr",
               ylab = yco2,
               slope_round_to = 4,
               kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_mfh[,c("abrechnungsjahr","total")]
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = berlin_co2_mfh[, c("abrechnungsjahr","total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehramiliengebäude\nCO2 Emissionen",
            columnNames = c("Jahr","kilo t."),
            columnWidths = c(1,1),
            columnsToRound = "kilo t."
)
```


* Now split by ET

```{r}
co2_mfh_allebezirke_byET <- co2_allebezirke_byET$mfh
#co2_mfh_allebezirke_byET
```


```{r}
co2_mfh_allebezirke_byET_cumsums <- getCumSums(obj=co2_mfh_allebezirke_byET , dropCols=c("abrechnungsjahr","total"))
#co2_mfh_allebezirke_byET_cumsums
```

```{r}
plot_byET(co2_mfh_allebezirke_byET_cumsums , xlabel = "Jahr" , ylabel = yco2 , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, Mehrfamiliengebäude, nach Energieträgern"),kt_to_mt = TRUE)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
co2_mfh_allebezirke_byET
```


```{r,fig.width=8.75,fig.height=6}
createTable(co2_mfh_allebezirke_byET,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Energieträgern (kilo t.)",
            columnNames =  c("Jahr","Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt")
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum 2002 - 2018 summiert in 1.000 t 



* Here CO2 emissions split by the bezirke

```{r}
berlin_co2_mfh_cumsums <- getCumSums(obj=berlin_co2_mfh , dropCols=c("abrechnungsjahr","total"))
plot_byBezirke(berlin_co2_mfh_cumsums , xlabel = "Jahr" , ylabel = yco2 , plottitle=changeCO2_to_CO_2("CO2 Emissionen in Berlin, Mehrfamiliengebäude, nach Bezirk"),kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=8.75,fig.height=6}
createTable(berlin_co2_mfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum 2002 - 2018 in Prozent

```{r}
co2_mfh_allebezirke_byET_prop <- find_proportions(co2_mfh_allebezirke_byET , drop_cols = c("abrechnungsjahr","total"))
co2_mfh_allebezirke_byET_prop_cumsums <- getCumSums(obj=co2_mfh_allebezirke_byET_prop , dropCols = "abrechnungsjahr")
plot_byET(co2_mfh_allebezirke_byET_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, Mehrfamiliengebäude, Anteile nach Energieträgern"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
co2_mfh_allebezirke_byET_prop
```

```{r,fig.width=8.75,fig.height=6}
createTable(co2_mfh_allebezirke_byET_prop,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen, Anteile nach Energieträgern (%)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom")
)
```


```{r}
berlin_co2_mfh_prop <- find_proportions(berlin_co2_mfh,drop_cols=c("abrechnungsjahr","total"))
berlin_co2_mfh_prop_cumsums <- getCumSums(berlin_co2_mfh_prop,dropCols="abrechnungsjahr")
plot_byBezirke(berlin_co2_mfh_prop_cumsums,xlabel = "Jahr" , ylabel = "Anteile in %" , plottitle = changeCO2_to_CO_2("CO2 Emissionen in Berlin, Mehrfamiliengebäude, Anteile nach Bezirk"))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
berlin_co2_mfh_prop
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh_prop[ , c(1:6,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)

```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh_prop[ , c(7:12,13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen, Anteile nach Bezirken (%)",
            columnNames =  c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick","Jahr"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum 2002 - 2018 in 1.000 t

(Eine Grafik: co2 Emissionen je Bezirk und Jahr)
Co2 emissions of all city districts by year in a single graph. (year on x-axis and co2 emission on y-axis).
One Graph: Co2 emissions of all city districts by year

```{r}
plot_reqdColumns(berlin_co2_mfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(berlin_co2_mfh)[!(names(berlin_co2_mfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2 Emissions",
                 xlabel = "Jahr",
                 ylabel = yco2,
                 plot_title = changeCO2_to_CO_2("CO2 Emissionen von Stadtbezirken, Mehrfamiliengebäude"),
                 kt_to_mt = TRUE)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,fig.width=10,fig.height=10}
gg_co2_mfh <- plot_bezirkeGridPlot(berlin_co2_mfh,ylabel=yco2,slope_round_to = 4,kt_to_mt = TRUE)
require(grid)
require(gridExtra)
grid.arrange(gg_co2_mfh[[1]],gg_co2_mfh[[2]],gg_co2_mfh[[3]],gg_co2_mfh[[4]],
             gg_co2_mfh[[5]],gg_co2_mfh[[6]],gg_co2_mfh[[7]],gg_co2_mfh[[8]],
             gg_co2_mfh[[9]],gg_co2_mfh[[10]],gg_co2_mfh[[11]],gg_co2_mfh[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2_mfh[[1]],gg_co2_mfh[[2]],gg_co2_mfh[[3]],gg_co2_mfh[[4]],
             gg_co2_mfh[[5]],gg_co2_mfh[[6]],gg_co2_mfh[[7]],gg_co2_mfh[[8]],
             gg_co2_mfh[[9]],gg_co2_mfh[[10]],gg_co2_mfh[[11]],gg_co2_mfh[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
berlin_co2_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken (kilo t.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum 2002 - 2018, Veränderung in Prozent

**(CO2 emitted by a bezirk for a particular year - Average CO2 emitted by a bezirk in particular year)/(Average CO2 emitted by a bezirk in particular year) times 100**


```{r,fig.width=10,fig.height=10}
berlin_co2_mfh_devFromMean <- getDeviationsFromMean(berlin_co2_mfh,
                                                    xVar = "abrechnungsjahr",
                                                    colsToAvgOver = names(berlin_co2_mfh)[
                                                      !(names(berlin_co2_mfh
                                                              ) %in% c("abrechnungsjahr","total"))]
)
ymin <- min(berlin_co2_mfh_devFromMean[ , 
                                        names(berlin_co2_mfh_devFromMean)[
                                          !(names(berlin_co2_mfh_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
ymax <- max(berlin_co2_mfh_devFromMean[ , 
                                        names(berlin_co2_mfh_devFromMean)[
                                          !(names(berlin_co2_mfh_devFromMean) %in% c("abrechnungsjahr",
                                                                                     "meanVal"))
                                                ]])
#plotDevFromMean(berlin_co2_all_devFromMean,"abrechnungsjahr","mitte",yMin=yMin,yMax=yMax)
g_co2dev_bezirk <- list()
for (ii in 1:12) {
  g_co2dev_bezirk[[ii]] <- plotDevFromMean(input_data = berlin_co2_mfh_devFromMean,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=ymin,
                                       ymax=ymax,
                                       ylabel="Abweichung vom Mittelwert (%)",
                                       plot_title = bezirk_name[ii])
}
require(grid)
require(gridExtra)
grid.arrange(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2dev_bezirk[[1]],g_co2dev_bezirk[[2]],g_co2dev_bezirk[[3]],g_co2dev_bezirk[[4]],
             g_co2dev_bezirk[[5]],g_co2dev_bezirk[[6]],g_co2dev_bezirk[[7]],g_co2dev_bezirk[[8]],
             g_co2dev_bezirk[[9]],g_co2dev_bezirk[[10]],g_co2dev_bezirk[[11]],g_co2dev_bezirk[[12]],ncol=3)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
berlin_co2_mfh_devFromMean
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh_devFromMean[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken, Abweichung vom jährlichen Mittelwert (%)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=6}
createTable(berlin_co2_mfh_devFromMean[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, CO2 Emissionen nach Bezirken, Abweichung vom jährlichen Mittelwert (%)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, Veränderung der CO2-Emission aus der Beheizung von Wohnraum 2002 - 2018 in Prozent

Skip this



```{r}
i_subsection <- i_subsection + 1
i_subsubsection <- 1
```

## `r i_section`.`r i_subsection`. Flächenbezug

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, Mehrfamiliengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum 2002 - 2018 in kg/m2[AN]

```{r}
bezirk_areas_mfh$abrechnungsjahr <- 2002:2018
#bezirk_areas_mfh
```

```{r}
spz_co2_mfh <- 1e6*berlin_co2_mfh$total/bezirk_areas_mfh$total
spez_co2_mfh <- data.frame(abrechnungsjahr=2002:2018 , spez_co2 = spz_co2_mfh )

points_line_lm(input_data = spez_co2_mfh,
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=max(spez_co2_mfh$spez_co2),
               x_eq = 2010,
               y_eq = 25,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, Mehrfamiliengebäude"),
               xlab = "Jahr",
               ylab = yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
#                       whatToSave = whatToSave)
```

```{r,results = showResults}
spez_co2_mfh
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = spez_co2_mfh[, c("abrechnungsjahr","spez_co2")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, \nSpezifische CO2 Emissionen",
            columnNames = c("Jahr","kg / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kg / q.m."
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, flächenbezogene CO2-Emission aus Beheizung von Wohnraum 2002 - 2008 in kg/m2[AN]

BOOKMARK - Section 3.2.2.

```{r}
bezirke_spez_co2_mfh <- 1e6*berlin_co2_mfh/bezirk_areas_mfh
bezirke_spez_co2_mfh$abrechnungsjahr <- 2002:2018
```



```{r}
plot_reqdColumns(bezirke_spez_co2_mfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirke_spez_co2_mfh)[!(names(bezirke_spez_co2_mfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2 Emissions in kg/m2",
                 xlabel = "Jahr",
                 ylabel = yspezco2,
                 plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen von Stadtbezirken, Mehrfamiliengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
#                       whatToSave = whatToSave)
```


```{r,fig.height=10,fig.width=10}
reqdCols <- names(bezirke_spez_co2_mfh)[!(names(bezirke_spez_co2_mfh) %in% c("abrechnungsjahr" , "total"))]
ymax <- max(bezirke_spez_co2_mfh [ , reqdCols])
g_co2spez_bezirk <- list()
for (ii in 1:12) {
  g_co2spez_bezirk[[ii]] <- points_line_lm(input_data = bezirke_spez_co2_mfh,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=ymax,
                                       x_eq = 2010,
                                       y_eq = 0.5*ymax,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = yspezco2)
}
require(grid)
require(gridExtra)
grid.arrange(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_co2spez_bezirk[[1]],g_co2spez_bezirk[[2]],g_co2spez_bezirk[[3]],g_co2spez_bezirk[[4]],
             g_co2spez_bezirk[[5]],g_co2spez_bezirk[[6]],g_co2spez_bezirk[[7]],g_co2spez_bezirk[[8]],
             g_co2spez_bezirk[[9]],g_co2spez_bezirk[[10]],g_co2spez_bezirk[[11]],g_co2spez_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
bezirke_spez_co2_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(bezirke_spez_co2_mfh[ , c(1:7)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, spezifische CO2 Emissionen (kg / q.m.)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=6}
createTable(bezirke_spez_co2_mfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, spezifische CO2 Emissionen (kg / q.m.)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)

```



```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum im Jahr 2018 in kg/m2[AN]

**2018 values for the specific CO2 emission in each bezirk**



```{r}
bezirke_spez_co2_mfh_linear <- linearizer(bezirke_spez_co2_mfh , dropCols = NULL , xVar = "abrechnungsjahr")
```


```{r}
#bezirke_spez_co2_mfh_linear
```



```{r}
bezirke_spez_co2_mfh_linear_2018 <- bezirke_spez_co2_mfh_linear[bezirke_spez_co2_mfh_linear$abrechnungsjahr==2018 , ]
bezirke_spezco2_mfh_linear_2018 <- as.data.frame(t(bezirke_spez_co2_mfh_linear_2018))
bezirke_spezco2_mfh_linear_2018$bezirk <- row.names(bezirke_spezco2_mfh_linear_2018)
names(bezirke_spezco2_mfh_linear_2018) <- c("wert","bezirk")
bezirke_spezco2_mfh_linear_2018 <- bezirke_spezco2_mfh_linear_2018[bezirke_spezco2_mfh_linear_2018$bezirk!="abrechnungsjahr" , ]
bezirke_spezco2_mfh_linear_2018 <- bezirke_spezco2_mfh_linear_2018[bezirke_spezco2_mfh_linear_2018$bezirk!="total" , ]
#bezirke_spezco2_mfh_linear_2018
```

```{r}
plot_spezCO2_2018(obj = bezirke_spezco2_mfh_linear_2018 , 
                  plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen 2018, Mehrfamiliengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results = showResults}
bezirke_spezco2_mfh_linear_2018
```

```{r,fig.width=3.5,fig.height=4.5}
createTable2018(obj = bezirke_spezco2_mfh_linear_2018[, c("bezirk","wert")],
            headerName = "Berlin, Mehrfamilingebäude,\nspezifische CO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, Mehrfamiliengebäude, flächenbezogene CO2-Emission aus Beheizung von Wohnraum nach Stadtbezirken, 2002 - 2008, 2002 = 100

```{r}
#get2002as100(spez_co2_mfh , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = get2002as100(spez_co2_mfh , "abrechnungsjahr"),
               xVar = "abrechnungsjahr",
               yVar = "spez_co2",
               ymin=0,
               ymax=110,
               x_eq = 2010,
               y_eq = 60,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Spezifische CO2 Emissionen in Berlin, Mehrfamiliengebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = " ")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
get2002as100(spez_co2_mfh , "abrechnungsjahr")
```


```{r,fig.width=2.5,fig.height=6}
createTable(obj = get2002as100(spez_co2_mfh , "abrechnungsjahr"),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude,\nspezifische CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Alle Stadtbezirke, Mehrfamiliengebäude, flächenbezogene CO2-Emission aus der Beheizung von Wohnraum, Entwicklung 2002 - 2018 und Niveau 2018 (Rang-folge)

**Specific CO2 emission in bezirk X in 2018 - Specific CO2 emission in Berlin in 2018**


```{r}
spez_co2_mfh_linear <- linearizer(spez_co2_mfh,dropCols=NULL,xVar="abrechnungsjahr")
spez_co2_mfh_linear_2018 <- spez_co2_mfh_linear$spez_co2[spez_co2_mfh_linear$abrechnungsjahr==2018]
#spez_co2_mfh_linear_2018
```

```{r}
#bezirke_spezco2_mfh_linear_2018
```

```{r}
bezirke_spezco2_mfh_linear_2018$dev_from_berlin <- bezirke_spezco2_mfh_linear_2018$wert - spez_co2_mfh_linear_2018
```

```{r}
plot_devFromBerlin2018(bezirke_spezco2_mfh_linear_2018,
                       changeCO2_to_CO_2("Abweichung von Berlin 2018, Spezifische CO2 Emissionen Mehrfamiliengebäude"),
                       yspezco2)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```



```{r,results = showResults}
bezirke_spezco2_mfh_linear_2018
```

```{r,fig.width=3.5,fig.height=4.5}
createTable2018(obj = bezirke_spezco2_mfh_linear_2018[, c("bezirk","dev_from_berlin")],
            headerName = "Bezirke, Mehrfamiliengebäude,\nspezifische CO2 Emissionen (2018)\nAbweichung von Berlin",
            columnNames = c("Bezirk","kg / q.m."),
            columnWidths = c(2,1),
            columnsToRound = "kg / q.m."
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Berlin, Mehrfamiliengebäude, durchschnittliche Emissionsminderung je qm Nutzfläche im Zeitraum 2012 - 2018

**Berlin, specific co2 emission with 2012 value as the reference**


```{r}
barPlot_delta2012(changeFrom2012(spez_co2_mfh), yspezco2 , changeCO2_to_CO_2("Spezifische CO2 Berlin, Mehrfamiliengebäude, zentriert um 2012"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
changeFrom2012(spez_co2_mfh)
```

```{r,fig.width=2.5,fig.height=6}
createTableZentriertUm2012(changeFrom2012(spez_co2_mfh)[,c("abrechnungsjahr","delta2012")],
            headerName = "Berlin, Mehrfamiliengebäude,\nSpezifiscche CO2 Emissionen\nZentriert um 2012",
            columnNames =  c("Jahr","kg / q.m."),
            columnWidths = rep(1,2),
            columnsToRound = c("kg / q.m.")
)
```

```{r}
i_subsection <- i_subsection + 1
i_subsubsection <- 1
```

## `r i_section`.`r i_subsection`. Emission pro Einwohner



### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emission aus der Beheizung von Wohnraum pro Einwohner

```{r}
#source("D:/GITHUB_REPOS/co2emissions/Berlin/BezirkAnalysis/getCo2PerCapitaBezirk_byGtype_method2.R")
bezirk_co2_percapita_mfh <- getCo2PerCapitaBezirk_byGtype_method2(berlin_co2_mfh , "MFH")
#bezirk_co2_percapita_mfh
```


```{r}
points_line_lm(input_data = bezirk_co2_percapita_mfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin=0,
               ymax=max(bezirk_co2_percapita_mfh$total),
               x_eq = 2010,
               y_eq = 1200,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, Mehrfamiliengebäude"),
               xlab = "Jahr",
               ylab = yco2perhead)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
bezirk_co2_percapita_mfh[ , c("abrechnungsjahr" , "total")]
```


```{r,fig.width=2.5,fig.height=6}
createTable(obj = bezirk_co2_percapita_mfh[ , c("abrechnungsjahr" , "total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude,\nPro Kopf CO2 Emissionen",
            columnNames = c("Jahr","kg"),
            columnWidths = c(1,1),
            columnsToRound = "kg"
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emission aus der Beheizung von Wohnraum pro Einwohner

```{r}
plot_reqdColumns(bezirk_co2_percapita_mfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirk_co2_percapita_mfh)[!(names(bezirk_co2_percapita_mfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "CO2PerCapita",
                 xlabel = "Jahr",
                 ylabel = yco2perhead,
                 plot_title = changeCO2_to_CO_2("CO2 Emissionen pro Kopf, Mehrfamiliengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.width=10,fig.height=10}
gg_co2perhead_bezirke <- plot_bezirkeGridPlot(bezirk_co2_percapita_mfh , ylabel = yco2perhead)
require(grid)
require(gridExtra)
grid.arrange(gg_co2perhead_bezirke[[1]],gg_co2perhead_bezirke[[2]],gg_co2perhead_bezirke[[3]],gg_co2perhead_bezirke[[4]],
             gg_co2perhead_bezirke[[5]],gg_co2perhead_bezirke[[6]],gg_co2perhead_bezirke[[7]],gg_co2perhead_bezirke[[8]],
             gg_co2perhead_bezirke[[9]],gg_co2perhead_bezirke[[10]],gg_co2perhead_bezirke[[11]],gg_co2perhead_bezirke[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2perhead_bezirke[[1]],gg_co2perhead_bezirke[[2]],gg_co2perhead_bezirke[[3]],gg_co2perhead_bezirke[[4]],
             gg_co2perhead_bezirke[[5]],gg_co2perhead_bezirke[[6]],gg_co2perhead_bezirke[[7]],gg_co2perhead_bezirke[[8]],
             gg_co2perhead_bezirke[[9]],gg_co2perhead_bezirke[[10]],gg_co2perhead_bezirke[[11]],gg_co2perhead_bezirke[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
bezirk_co2_percapita_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(bezirk_co2_percapita_mfh[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Bezirke, Mehrfamiliengebäude, Pro Kopf CO2 Emissionen (kg)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=6}
createTable(bezirk_co2_percapita_mfh[ , c(1,8:13)],
            isHeader = TRUE,
            headerName = "Bezirke, Mehrfamiliengebäude, Pro Kopf CO2 Emissionen (kg)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emission pro Einwohner aus der Beheizung von Wohnraum, 2002 - 2008, 2002 = 100

```{r}
bezirk_co2_percapita_2002as100_mfh <- get2002as100(bezirk_co2_percapita_mfh , "abrechnungsjahr")
```

```{r}
points_line_lm(input_data = bezirk_co2_percapita_2002as100_mfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin=0,
               ymax=max(bezirk_co2_percapita_2002as100_mfh$total),
               x_eq = 2010,
               y_eq = 70,
               size_eq = 4,
               plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Berlin, Mehrfamiliengebäude, 2002 Wert = 100"),
               xlab = "Jahr",
               ylab = " ")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.width=2.5,fig.height=6}
createTable(obj = bezirk_co2_percapita_2002as100_mfh[ , c("abrechnungsjahr","total")],
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude,\nPro Kopf CO2 Emissionen\n(2002 Wert = 100)",
            columnNames = c("Jahr","Wert"),
            columnWidths = c(1,1),
            columnsToRound = "Wert"
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```


### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emission pro Einwohner aus der Beheizung von Wohnraum

```{r}
plot_reqdColumns(bezirk_co2_percapita_2002as100_mfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(bezirk_co2_percapita_2002as100_mfh)[!(names(bezirk_co2_percapita_2002as100_mfh) %in% c("abrechnungsjahr","total"))],
                 yColsName = "Bezirk",
                 yVar = "co2 pro head, 2002=100",
                 xlabel="Jahr",
                 ylabel = NULL,
                 plot_title = changeCO2_to_CO_2("Pro Kopf CO2 Emissionen in Stadtbezirken, Mehrfamiliengebäude, 2002 Wert = 100"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,fig.height=10,fig.width=10}
gg_co2perhead_2002As100 <- plot_bezirkeGridPlot(bezirk_co2_percapita_2002as100_mfh,ylabel="")
require(grid)
require(gridExtra)
grid.arrange(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
whatToSave <- arrangeGrob(gg_co2perhead_2002As100[[1]],gg_co2perhead_2002As100[[2]],gg_co2perhead_2002As100[[3]],gg_co2perhead_2002As100[[4]],
             gg_co2perhead_2002As100[[5]],gg_co2perhead_2002As100[[6]],gg_co2perhead_2002As100[[7]],gg_co2perhead_2002As100[[8]],
             gg_co2perhead_2002As100[[9]],gg_co2perhead_2002As100[[10]],gg_co2perhead_2002As100[[11]],gg_co2perhead_2002As100[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```

```{r,results = showResults}
bezirk_co2_percapita_2002as100_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(bezirk_co2_percapita_2002as100_mfh[,1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln")
)
```

```{r,fig.width=10,fig.height=6}
createTable(bezirk_co2_percapita_2002as100_mfh[,c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Pro Kopf CO2 Emissionen nach Bezirken, 2002 Wert = 100",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick")
)
```


```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner, Niveau im Jahr 2018 in t/Einwohner

```{r}
bezirk_co2_percapita_mfh_linear <- linearizer(bezirk_co2_percapita_mfh,dropCols = NULL , xVar = "abrechnungsjahr")

bezirk_co2_percapita_mfh_linear_2018 <- bezirk_co2_percapita_mfh_linear[bezirk_co2_percapita_mfh_linear$abrechnungsjahr==2018 , ]
bezirk_co2_percapita_mfh_linear_2018 <-  as.data.frame(t(bezirk_co2_percapita_mfh_linear_2018))
bezirk_co2_percapita_mfh_linear_2018$bezirk <- row.names(bezirk_co2_percapita_mfh_linear_2018)
names(bezirk_co2_percapita_mfh_linear_2018) <- c("wert","bezirk")
bezirk_co2_percapita_mfh_linear_2018 <- bezirk_co2_percapita_mfh_linear_2018[bezirk_co2_percapita_mfh_linear_2018$bezirk!="abrechnungsjahr" , ]
bezirk_co2_percapita_mfh_linear_2018 <- bezirk_co2_percapita_mfh_linear_2018[bezirk_co2_percapita_mfh_linear_2018$bezirk!="total" , ]

plot_co2perhead_2018(bezirk_co2_percapita_mfh_linear_2018,
                     ylabel = yco2perhead,
                     plot_title = changeCO2_to_CO_2("CO2 Emissionen pro Einwohner in Stadtbezirken 2018, Mehrfamiliengebäude"))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
bezirk_co2_percapita_mfh_linear_2018
```

```{r,fig.width=3.5,fig.height=4.5}
createTable2018(obj = bezirk_co2_percapita_mfh_linear_2018[, c("bezirk","wert")],
            headerName = "Bezirke, Mehrfamiliengebäude,\npro Kopf CO2 Emissionen (2018)",
            columnNames = c("Bezirk","kg"),
            columnWidths = c(2,1),
            columnsToRound = "kg"
)
```

```{r}
i_subsubsection <- i_subsubsection + 1
```

### `r i_section`.`r i_subsection`.`r i_subsubsection`. Stadtbezirke, Mehrfamiliengebäude, CO2-Emissionen aus der Beheizung von Wohnraum pro Einwohner, Veränderung 2002 / 2018 in Prozent


```{r}
i_subsection <- i_subsection + 1
i_subsubsection <- 1
```

## `r i_section`.`r i_subsection`. Prognose


$R^2$ für Polynom 1. Grades

```{r}
linmodel_mfh <- lm(total~abrechnungsjahr,data=berlin_co2_mfh)
summary(linmodel_mfh)$r.squared
```

$R^2$ für Polynom 2. Grades

```{r}
quadmodel_mfh <- lm(total~abrechnungsjahr+I(abrechnungsjahr^2),data=berlin_co2_mfh)
summary(quadmodel_mfh)$r.squared
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_mfh_lin <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(linmodel_mfh,newdata=from2002_till_2030)))
b0_grad1 <- 0.001*round(as.numeric(linmodel_mfh$coefficients[1]) , 2)
b1_grad1 <- 0.001*round(as.numeric(linmodel_mfh$coefficients[2]) , 2)
eq_grad1 <- paste0("y = ", b1_grad1 , "x + ", b0_grad1)
ggplot(convert_kilo_to_megaton(prognose_mfh_lin,"abrechnungsjahr") , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title="CO2 Emissionen in Berlin, Mehrfamiliengebäude (Polynom 1. Grades)",y=yco2,x="Jahr"
)+annotate(
  geom="text",label=eq_grad1,x=2015,y=0.001*0.65*max(prognose_mfh_lin$pred),size=5
  ) + ylim(0,0.001*max(prognose_mfh_lin$pred))+scale_x_continuous(breaks=seq(2002,2030,4))
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r}
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_mfh_quad <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(quadmodel_mfh,newdata=from2002_till_2030)))
b0_grad2 <- round(as.numeric(quadmodel_mfh$coefficients[1]) , 2)
b1_grad2 <- round(as.numeric(quadmodel_mfh$coefficients[2]) , 2)
b2_grad2 <- round(as.numeric(quadmodel_mfh$coefficients[3]) , 2)
eq_grad2 <- paste0("y = ",b2_grad2,"x^2 + ",b1_grad2 , "x + ", b0_grad2)
ggplot(prognose_mfh_quad , aes(x=abrechnungsjahr , y = pred))+geom_point()+labs(title="CO2 Emissionen in Berlin, Mehrfamiliengebäude (Polynom 2. Grades)",y="kilo t.",x="Jahr")+annotate(
  geom="text",label=eq_grad2,x=2015,y=0.65*max(prognose_mfh_quad$pred),size=5
) + ylim(0,max(prognose_mfh_quad$pred))+scale_x_continuous(breaks=seq(2002,2030,4))
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,results=showResults}
prognose_mfh_lin
```

```{r,results=showResults}
prognose_mfh_quad
```


Earlier Code:


```{r}
quadmodel_mfh <- lm(total~abrechnungsjahr+I(abrechnungsjahr^2),data=berlin_co2_mfh)
from2002_till_2030 <- data.frame(abrechnungsjahr=2002:2030)
prognose_mfh <- data.frame(abrechnungsjahr = 2002:2030 , pred = as.numeric(predict(quadmodel_mfh,newdata=from2002_till_2030)))
ggplot(prognose_mfh , aes(x=abrechnungsjahr , y = pred))+geom_point()
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results=showResults}
prognose_mfh
```

Johannes used to use the index of the years, with 0 for 2002, 1 for 2003, and so on. I should do the same:

```{r}
berlin_co2_mfh_temp <- berlin_co2_mfh
berlin_co2_mfh_temp$jahrIndex <- berlin_co2_mfh_temp$abrechnungsjahr - 2002
quadmodel2_mfh <- lm(total~jahrIndex+I(jahrIndex^2),data=berlin_co2_mfh_temp)
from2002_till_2030_index <- data.frame(jahrIndex=(2002:2030) - 2002)
prognose2_mfh <- data.frame(jahrIndex = (2002:2030)-2002 , pred = as.numeric(predict(quadmodel2_mfh,newdata=from2002_till_2030_index)))
ggplot(prognose2_mfh , aes(x=jahrIndex , y = pred))+geom_point()
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```






```{r}
i_subsection <- i_subsection + 1
```

## `r i_section`.`r i_subsection`. Diskussion




```{r}
i_section <- i_section + 1
i_subsection <- 1
```


# `r i_section`.	Heizenergieverbrauch nach Stadtbezirken 2002 - 2018, alle Wohngebäude 

```{r}
gtypeForFig <- "ALL"
```

## `r i_section`.`r i_subsection`.	Stadtbezirke, alle Wohngebäude, Heizenergieverbrauch 2002 - 2018

```{r}
#* `getAllBezirkeTotalCO2.R` and `getAllBezirkeByETCO2.R` both invoke `mainScriptCO2Emissions_v2.R`.
#* `mainScriptCO2Emissions_v2.R` creates the attribute `energy_shares_absolute`. This is the energy produced by the respective ETs.
#* So modify the returned object in `getAllBezirkeTotalCO2.R` and `getAllBezirkeByETCO2.R` so that it includes the `energy_shares_absolute` as well.
#* Total energy split by ET:
```

```{r}
by_ten_9 <- 1e-9
aes_by_ET_TWh <- by_ten_9 * co2_allebezirke_byET$aes_all
aes_by_ET_TWh$abrechnungsjahr <- 2002:2018
aes_by_ET_TWh_cumsums <- getCumSums(obj=aes_by_ET_TWh , dropCols = c("abrechnungsjahr","total"))
```

```{r}
points_line_lm(input_data = aes_by_ET_TWh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(aes_by_ET_TWh$total),
               x_eq = 2010,
               y_eq = 0.1,
               size_eq = 4,
               plot_title = "Energieverbrauch in Berlin, alle Wohnungen",
               xlab = "Jahr",
               ylab = "TWh",
               slope_round_to = 4)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh[ , c("abrechnungsjahr" , "total")]
```


```{r,fig.width=2.5,fig.height=6}
createTable(obj = aes_by_ET_TWh[ , c("abrechnungsjahr" , "total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, \nHeizenergieverbrauch",
            columnNames = c("Jahr","TWh"),
            columnWidths = c(1,1),
            columnsToRound = "TWh"
)
```

```{r}
plot_byET(aes_by_ET_TWh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle = "Energieverbrauch in Berlin, alle Wohngebäude, nach Energieträgern")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh
```


```{r,fig.width=8.75,fig.height=6}
createTable(aes_by_ET_TWh,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, Heizenergieverbrauch nach Energieträgern (TWh)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            roundOffTo=3
)
```

```{r}
#* Total energy split by bezirk:
```
  
```{r}
by_ten_9 <- 1e-9
aes_by_bezirk_TWh <- by_ten_9 * alle_bezirke_co2$aes_all
aes_by_bezirk_TWh$abrechnungsjahr <- 2002:2018
aes_by_bezirk_TWh_cumsums <- getCumSums(obj=aes_by_bezirk_TWh , dropCols = "abrechnungsjahr")
```

```{r}
plot_byBezirke(aes_by_bezirk_TWh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle="Energieverbrauch in Berlin, alle Wohngebäude, nach Bezirk")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_bezirk_TWh
```


```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, alle Wohngebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```



```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, alle Wohngebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```



```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, alle Wohngebäude, Heizenergieverbrauch 2002 - 2018

```{r}
#Eine Grafik: Heizenergieverbrauch aller 12 Bezirke in einer Grafik)
#One Graph: All 12 lines in a single graph.
```

```{r}
#aes_by_bezirk_kWh <- 1e9 * aes_by_bezirk_TWh
#aes_by_bezirk_kWh$abrechnungsjahr <- 2002:2018
#aes_by_bezirk_TWh
```

```{r}
plot_reqdColumns(aes_by_bezirk_TWh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(aes_by_bezirk_TWh)[!(names(aes_by_bezirk_TWh) %in% c("abrechnungsjahr"))],
                 yColsName = "Bezirk",
                 yVar = "Energy in TWh",
                 xlab = "Jahr",
                 ylab = "TWh",
                 plot_title = "Energieverbrauch in Stadtbezirken, alle Wohngebäude")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.height=10,fig.width=10}
max_aes_value <- max(aes_by_bezirk_TWh[ , names(aes_by_bezirk_TWh)[!(names(aes_by_bezirk_TWh) %in% c("abrechnungsjahr","total"))]])
require(ggplot2)
g_aes_bezirk <- list()
for (ii in 1:12) {
  g_aes_bezirk[[ii]] <- points_line_lm(input_data = aes_by_bezirk_TWh,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=max_aes_value,
                                       x_eq = 2010,
                                       y_eq = 0.5*max_aes_value,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = "TWh",
                                       slope_round_to = 4,
                                       intercept_round_to = 2)
}
require(grid)
require(gridExtra)
grid.arrange(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
aes_by_bezirk_TWh
```


```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, alle Wohngebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```

```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, alle Wohngebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`.	Stadtbezirke, alle Wohngebäude, flächenbezogener Heizenergieverbrauch 2002 - 2018 in kWh/(m2[AN]*a) 

```{r}
#* `bezirk_areas_all$total` gives the total areas of berlin (MFH+SFH).

#* `aes_by_ET_TWh$total` gives the total TWh consumption.

#* So the quotient will give the per unit area consumption.
```

```{r}
spz_verbrauch_all <- data.frame(abrechnungsjahr=2002:2018,
                                kWh_per_m2 = 1e9 * aes_by_ET_TWh$total/bezirk_areas_all$total)
points_line_lm(input_data = spz_verbrauch_all,
               xVar = "abrechnungsjahr",
               yVar = "kWh_per_m2",
               ymin = 0,
               ymax = max(spz_verbrauch_all$kWh_per_m2),
               x_eq = 2010,
               y_eq = 0.8,
               size_eq = 4,
               plot_title = "Spezifischer Energieverbrauch in Berlin, alle Wohngebäude",
               xlab = "Jahr",
               ylab = "kWh/q.m.")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
spz_verbrauch_all
```


```{r,fig.width=3,fig.height=6}
createTable(obj = spz_verbrauch_all,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude, \nspezifischer Heizenergieverbrauch",
            columnNames = c("Jahr","kWh / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kWh / q.m."
)

```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, alle Wohngebäude, flächenbezogener Heizenergieverbrauch und beheizte Wohnfläche 2002 - 2018

Plot of the total area (to be combined with the specific energy consumption into one picture):

```{r}
###########################################################################################
#plot(2002:2018 , bezirk_areas_all$total,ylim=c(0,max(bezirk_areas_all$total)),col="blue")
#par(new=TRUE)
#plot(2002:2018, spz_verbrauch_all$kWh_per_m2,xlab="", ylab="", #ylim=c(0,max(spz_verbrauch_all$kWh_per_m2)), axes = FALSE)
###########################################################################################

#spz_verbrauch_all$kWh_per_m2
#make a function to plot two quantities, a dual plot, one on the left axis and the other on the right axis. Plot the linearized versions of these

plot_dualPlot <- function(y1 , y2 , x , xlab, ylab1 , ylab2, ylegend1, ylegend2) {
  dframe <- data.frame(x=x , y1=y1 , y2=y2)
 lm1 <- lm(y1~x , data = dframe)
 lm2 <- lm(y2~x , data = dframe)
 #replace with linear predictions
 y1 <- as.numeric(lm1$fitted.values)
 y2 <- as.numeric(lm2$fitted.values)
 
 par(mar=c(5, 4, 4, 6) + 0.1)
 plot(x,y1,ylim=c(0,max(y1)),col="black",xlab=xlab,ylab=ylab1,pch=16)
 
 par(new=TRUE)
 
 plot(x,y2,xlab="", ylab="", ylim=c(0,max(y2)), axes = FALSE , col = "red",pch=15)
 mtext(ylab2, side = 4, line = 4,col="red")
 axis(4, ylim=c(0,max(y2)), col="red",col.axis="red",las=1)

 legend("bottomleft", c(ylegend1, ylegend2),
       col = c("black", "red"), pch = c(16, 15))
 
}
```

```{r}
plot_dualPlot(1e-6*bezirk_areas_all$total,
              spz_verbrauch_all$kWh_per_m2,
              2002:2018,
              "Jahr",
              "Wohnfläche, alle Wohngebäude (Mio. q.m.)",
              "kWh / q.m.",
              "Wohnfläche",
              "Heizenergieverbrauch pro q.m.")
```


```{r,results = showResults}
data.frame(Jahr=2002:2018 , area=1e-6*bezirk_areas_all$total,
              spez_verbrauch = spz_verbrauch_all$kWh_per_m2)
```

```{r,fig.width=5,fig.height=7}
createTable(obj = data.frame(Jahr=2002:2018 , area=1e-6*bezirk_areas_all$total,
              spez_verbrauch = spz_verbrauch_all$kWh_per_m2),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, alle Wohngebäude",
            columnNames = c("Jahr","Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)"),
            columnWidths = c(1,1,1),
            columnsToRound = c("Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)")
)

```








```{r}
i_section <- i_section + 1
i_subsection <- 1
```

# `r i_section`. Heizenergieverbrauch nach Stadtbezirken 2002 - 2018, 1-2 Familiengebäude 

```{r}
gtypeForFig <- "SFH"
```

## `r i_section`.`r i_subsection`. Stadtbezirke, 1-2 Familiengebäude, Heizenergieverbrauch 2002 - 2018 summiert 

```{r}
#* Total energy split by ET:
```
  
```{r}
by_ten_9 <- 1e-9
aes_by_ET_TWh_sfh <- by_ten_9 * co2_allebezirke_byET$aes_sfh
aes_by_ET_TWh_sfh$abrechnungsjahr <- 2002:2018
aes_by_ET_TWh_sfh_cumsums <- getCumSums(obj=aes_by_ET_TWh_sfh , dropCols = c("abrechnungsjahr","total"))
```

```{r}
points_line_lm(input_data = aes_by_ET_TWh_sfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(aes_by_ET_TWh_sfh$total),
               x_eq = 2010,
               y_eq = 0.025,
               size_eq = 4,
               plot_title = "Energieverbrauch in Berlin, 1-2 Familiengebäude",
               xlab = "Jahr",
               ylab = "TWh",
               slope_round_to = 4)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh_sfh[, c("abrechnungsjahr","total")]
```


```{r,fig.width=2.5,fig.height=6}
createTable(obj = aes_by_ET_TWh_sfh[ , c("abrechnungsjahr" , "total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, \nHeizenergieverbrauch",
            columnNames = c("Jahr","TWh"),
            columnWidths = c(1,1),
            columnsToRound = "TWh",
            roundOffTo = 5
)
```

```{r}
plot_byET(aes_by_ET_TWh_sfh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle = "Energieverbrauch in Berlin, 1-2 Familiengebäude, nach Energieträgern")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh_sfh
```


```{r,fig.width=8.75,fig.height=6}
createTable(aes_by_ET_TWh_sfh,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, Heizenergieverbrauch nach Energieträgern (TWh)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            roundOffTo=3
)
```

* Total energy split by bezirk:
```{r}
by_ten_9 <- 1e-9
aes_by_bezirk_TWh_sfh <- by_ten_9 * alle_bezirke_co2$aes_sfh
aes_by_bezirk_TWh_sfh$abrechnungsjahr <- 2002:2018
aes_by_bezirk_TWh_sfh_cumsums <- getCumSums(obj=aes_by_bezirk_TWh_sfh , dropCols = "abrechnungsjahr")
```

```{r}
plot_byBezirke(aes_by_bezirk_TWh_sfh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle="Energieverbrauch in Berlin, 1-2 Familiengebäude, nach Bezirk")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_bezirk_TWh_sfh
```


```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_sfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, 1-2 Familiengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```



```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_sfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, 1-2 Familiengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```


```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, 1-2 Familiengebäude, Heizenergieverbrauch 2002 - 2018




```{r}
plot_reqdColumns(aes_by_bezirk_TWh_sfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(aes_by_bezirk_TWh_sfh)[!(names(aes_by_bezirk_TWh_sfh) %in% c("abrechnungsjahr"))],
                 yColsName = "Bezirk",
                 yVar = "Energy in TWh",
                 xlab = "Jahr",
                 ylab = "TWh",
                 plot_title = "Energieverbrauch in Stadtbezirken, 1-2 Familiengebäude")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```


```{r,fig.height=10,fig.width=10}
max_aes_value <- max(aes_by_bezirk_TWh_sfh[ , names(aes_by_bezirk_TWh_sfh)[!(names(aes_by_bezirk_TWh_sfh) %in% c("abrechnungsjahr","total"))]])
require(ggplot2)
g_aes_bezirk <- list()
for (ii in 1:12) {
  g_aes_bezirk[[ii]] <- points_line_lm(input_data = aes_by_bezirk_TWh_sfh,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=max_aes_value,
                                       x_eq = 2010,
                                       y_eq = 0.5*max_aes_value,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = "TWh",
                                       slope_round_to = 4,
                                       intercept_round_to = 2)
}
require(grid)
require(gridExtra)
grid.arrange(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)
whatToSave <- arrangeGrob(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```


```{r,results = showResults}
aes_by_bezirk_TWh_sfh
```


```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_sfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, 1-2 Familiengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```



```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_sfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, 1-2 Familiengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, 1-2 Familiengebäude, flächenbezogener Heizenergieverbrauch 2002 - 2018 in kWh/(m2[AN]*a) 



```{r}
spz_verbrauch_sfh <- data.frame(abrechnungsjahr=2002:2018,
                                kWh_per_m2 = 1e9 * aes_by_ET_TWh_sfh$total/bezirk_areas_sfh$total)
points_line_lm(input_data = spz_verbrauch_sfh,
               xVar = "abrechnungsjahr",
               yVar = "kWh_per_m2",
               ymin = 0,
               ymax = max(spz_verbrauch_sfh$kWh_per_m2),
               x_eq = 2010,
               y_eq = 1.25,
               size_eq = 4,
               plot_title = "Spezifischer Energieverbrauch in Berlin, 1-2 Familiengebäude",
               xlab = "Jahr",
               ylab = "kWh/q.m.")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
spz_verbrauch_sfh
```

```{r,fig.width=3,fig.height=6}
createTable(obj = spz_verbrauch_sfh,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude, \nspezifischer Heizenergieverbrauch",
            columnNames = c("Jahr","kWh / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kWh / q.m."
)
```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, 1-2 Familiengebäude, flächenbezogener Heizenergieverbrauch und beheizte Wohnfläche 2002 - 2018




```{r}
plot_dualPlot(1e-6*bezirk_areas_sfh$total,
              spz_verbrauch_sfh$kWh_per_m2,
              2002:2018,
              "Jahr",
              "Nutzfläche, 1-2 Familiengebäude (Mio. q.m.)",
              "kWh/m2",
              "Nutzfläche",
              "spezifischer Heizenergieverbrauch")
```


```{r,results = showResults}
data.frame(Jahr=2002:2018,
area= bezirk_areas_sfh$total,
              spez_verbrauch = spz_verbrauch_sfh$kWh_per_m2)
```



```{r,fig.width=5,fig.height=7}
createTable(obj = data.frame(Jahr=2002:2018 , area=1e-6*bezirk_areas_sfh$total,
              spez_verbrauch = spz_verbrauch_sfh$kWh_per_m2),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, 1-2 Familiengebäude",
            columnNames = c("Jahr","Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)"),
            columnWidths = c(1,1,1),
            columnsToRound = c("Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)")
)
```










```{r}
i_section <- i_section + 1
i_subsection <- 1
```

# `r i_section`. Heizenergieverbrauch nach Stadtbezirken 2002 - 2018, Mehrfamiliengebäude 

## `r i_section`.`r i_subsection`. Stadtbezirke, Mehrfamiliengebäude, Heizenergieverbrauch 2002 - 2018 summiert 

```{r}
#* Total energy split by ET:
gtypeForFig <- "MFH"
```

```{r}
by_ten_9 <- 1e-9
aes_by_ET_TWh_mfh <- by_ten_9 * co2_allebezirke_byET$aes_mfh
aes_by_ET_TWh_mfh$abrechnungsjahr <- 2002:2018
aes_by_ET_TWh_mfh_cumsums <- getCumSums(obj=aes_by_ET_TWh_mfh , dropCols = c("abrechnungsjahr","total"))
```

```{r}
points_line_lm(input_data = aes_by_ET_TWh_mfh,
               xVar = "abrechnungsjahr",
               yVar = "total",
               ymin = 0,
               ymax = max(aes_by_ET_TWh_mfh$total),
               x_eq = 2010,
               y_eq = 0.025,
               size_eq = 4,
               plot_title = "Energieverbrauch in Berlin, Mehrfamiliengebäude",
               xlab = "Jahr",
               ylab = "TWh",
               slope_round_to = 4)
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh_mfh[ , c("abrechnungsjahr","total")]
```

```{r,fig.width=2.5,fig.height=6}
createTable(obj = aes_by_ET_TWh_mfh[ , c("abrechnungsjahr" , "total")],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, \nHeizenergieverbrauch",
            columnNames = c("Jahr","TWh"),
            columnWidths = c(1,1),
            columnsToRound = "TWh",
            roundOffTo = 5
)
```


```{r}
plot_byET(aes_by_ET_TWh_mfh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle = "Energieverbrauch in Berlin, Mehrfamiliengebäude, nach Energieträgern")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_ET_TWh_mfh
```

```{r,fig.width=8.75,fig.height=6}
createTable(aes_by_ET_TWh_mfh,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, Heizenergieverbrauch nach Energieträgern (TWh)",
            columnNames =  c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Jahr","Gesamt"),
            columnWidths = rep(1,8),
            columnsToRound = c("Erdgas","Wärme","Flüssiggas","Heizöl","Holzpellets","Strom","Gesamt"),
            roundOffTo=3
)
```


```{r}
#* Total energy split by bezirk:
```

```{r}
by_ten_9 <- 1e-9
aes_by_bezirk_TWh_mfh <- by_ten_9 * alle_bezirke_co2$aes_mfh
aes_by_bezirk_TWh_mfh$abrechnungsjahr <- 2002:2018
aes_by_bezirk_TWh_mfh_cumsums <- getCumSums(obj=aes_by_bezirk_TWh_mfh , dropCols = "abrechnungsjahr")
```

```{r}
plot_byBezirke(aes_by_bezirk_TWh_mfh_cumsums , xlabel = "Jahr" , ylabel = "TWh" , plottitle="Energieverbrauch in Berlin, Mehrfamiliengebäude, nach Bezirk")
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
aes_by_bezirk_TWh_mfh
```

```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_mfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, Mehrfamiliengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```

```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_mfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, Mehrfamiliengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```




```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, Mehrfamiliengebäude Wohngebäude, Heizenergieverbrauch 2002 - 2018




```{r}
plot_reqdColumns(aes_by_bezirk_TWh_mfh,
                 xVar = "abrechnungsjahr",
                 cols_to_plot = names(aes_by_bezirk_TWh_mfh)[!(names(aes_by_bezirk_TWh_mfh) %in% c("abrechnungsjahr"))],
                 yColsName = "Bezirk",
                 yVar = "Energy in TWh",
                 xlab = "Jahr",
                 ylab = "TWh",
                 plot_title = "Energieverbrauch in Stadtbezirken, Mehrfamiliengebäude")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```
                 
                 
```{r,fig.height=10,fig.width=10}
max_aes_value <- max(aes_by_bezirk_TWh_mfh[ , names(aes_by_bezirk_TWh_mfh)[!(names(aes_by_bezirk_TWh_mfh) %in% c("abrechnungsjahr","total"))]])
require(ggplot2)
g_aes_bezirk <- list()
for (ii in 1:12) {
  g_aes_bezirk[[ii]] <- points_line_lm(input_data = aes_by_bezirk_TWh_mfh,
                                       xVar = "abrechnungsjahr",
                                       yVar = bezirk_list[ii],
                                       ymin=0,
                                       ymax=max_aes_value,
                                       x_eq = 2010,
                                       y_eq = 0.5*max_aes_value,
                                       size_eq = 4,
                                       plot_title = bezirk_name[ii],
                                       xlab = "Jahr",
                                       ylab = "TWh",
                                       slope_round_to = 4,
                                       intercept_round_to = 2)
}
require(grid)
require(gridExtra)
grid.arrange(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)   
whatToSave <- arrangeGrob(g_aes_bezirk[[1]],g_aes_bezirk[[2]],g_aes_bezirk[[3]],g_aes_bezirk[[4]],
             g_aes_bezirk[[5]],g_aes_bezirk[[6]],g_aes_bezirk[[7]],g_aes_bezirk[[8]],
             g_aes_bezirk[[9]],g_aes_bezirk[[10]],g_aes_bezirk[[11]],g_aes_bezirk[[12]],ncol=3)   
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex,
                       whatToSave = whatToSave)
```                 
                 

```{r,results = showResults}
aes_by_bezirk_TWh_mfh
```                 

```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_mfh[ , 1:7],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, Mehrfamiliengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            columnWidths = rep(1,7),
            columnsToRound = c("Charlottenburg-\nWilmersdorf","Friedrichshain-\nKreuzberg","Lichtenberg","Marzahn-\nHellersdorf","Mitte","Neukölln"),
            roundOffTo=3
)
```

```{r,fig.width=10,fig.height=6}
createTable(aes_by_bezirk_TWh_mfh[ , c(1,8:13)],
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berliner, Mehrfamiliengebäude, Heizenergieverbrauch nach Bezirken (TWh)",
            columnNames =  c("Jahr","Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            columnWidths = rep(1,7),
            columnsToRound = c("Pankow","Reinickendorf","Spandau","Steglitz-\nZehlendorf","Tempelhof-\nSchöneberg","Treptow-\nKöpenick"),
            roundOffTo = 3
)
```

```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, Mehrfamiliengebäude, flächenbezogener Heizenergieverbrauch 2002 - 2018 in kWh/(m2[AN]*a) 



```{r}
spz_verbrauch_mfh <- data.frame(abrechnungsjahr=2002:2018,
                                kWh_per_m2 = 1e9 * aes_by_ET_TWh_mfh$total/bezirk_areas_mfh$total)
points_line_lm(input_data = spz_verbrauch_mfh,
               xVar = "abrechnungsjahr",
               yVar = "kWh_per_m2",
               ymin = 0,
               ymax = max(spz_verbrauch_mfh$kWh_per_m2),
               x_eq = 2010,
               y_eq = 1.1,
               size_eq = 4,
               plot_title = "Spezifischer Energieverbrauch in Berlin, Mehrfamiliengebäude",
               xlab = "Jahr",
               ylab = "kWh/q.m.")
figIndex <- 1
figIndex <- saveFigure(gtypeForFig=gtypeForFig , 
                       section = i_section,
                       subsection = i_subsection,
                       subsubsection = i_subsubsection, 
                       figIndex=figIndex)
```

```{r,results = showResults}
spz_verbrauch_mfh
```

```{r,fig.width=3.5,fig.height=6}
createTable(obj = spz_verbrauch_mfh,
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude, \nspezifischer Heizenergieverbrauch",
            columnNames = c("Jahr","kWh / q.m."),
            columnWidths = c(1,1),
            columnsToRound = "kWh / q.m."
)
```



```{r}
i_subsection <- i_subsection+1
```

## `r i_section`.`r i_subsection`. Stadtbezirke, Mehrfamiliengebäude, flächenbezogener Heizenergieverbrauch und beheizte Wohnfläche 2002 - 2018

Plot of the MFH area (to be combined with the specific energy consumption into one picture):

```{r}
plot_dualPlot(1e-6*bezirk_areas_mfh$total,
              spz_verbrauch_mfh$kWh_per_m2,
              2002:2018,
              "Jahr",
              "Nutzfläche, Mehrfamiliengebäude (Mio. q.m.)",
              "kWh/m2",
              "Nutzfläche",
              "spezifischer Heizenergieverbrauch")
```


```{r,results = showResults}
data.frame(Jahr=2002:2018,
area= bezirk_areas_mfh$total,
              spez_verbrauch = spz_verbrauch_mfh$kWh_per_m2)
```

```{r,fig.width=5,fig.height=7}
createTable(obj = data.frame(Jahr=2002:2018 , area=1e-6*bezirk_areas_mfh$total,
              spez_verbrauch = spz_verbrauch_mfh$kWh_per_m2),
            fontSize = 10,
            isHeader = TRUE,
            headerName = "Berlin, Mehrfamiliengebäude",
            columnNames = c("Jahr","Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)"),
            columnWidths = c(1,1,1),
            columnsToRound = c("Wohnfläche\n(Mio. q.m.)","spezifischer\nHeizenergie-\nverbrauch\n(kWh/q.m.)")
)
```

















# Diskussion

* Section 5.2, 1-2 FH energy consumption is increasing for Lichtenberg and Marzahn-Hellersdorf.
* Treptow-Kopenick. Energy consumption for MFH is stagnant. Also Marzahn-Hellersdorf (almost stagnant) and Pankow.
* How does the age of the buildings compare with the co2 emission/energy efficiency?